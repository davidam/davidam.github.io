<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es">
<head>
<title>Manual de Programación en Drupal 7</title>
<!-- 2013-12-20 vie 12:48 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="David Arroyo Menéndez" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/javascript" src="http://orgmode.org/mathjax/MathJax.js"></script>
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        // Only one of the two following lines, depending on user settings
        // First allows browser-native MathML display, second forces HTML/CSS
        //  config: ["MMLorHTML.js"], jax: ["input/TeX"],
            jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 100,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        }
    });
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Manual de Programación en Drupal 7</h1>
<div id="table-of-contents">
<h2>&Iacute;ndice</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">API de Drupal</a>
<ul>
<li><a href="#sec-1-1">db\<sub>query</sub></a></li>
<li><a href="#sec-1-2">node\<sub>load</sub></a></li>
<li><a href="#sec-1-3">user\<sub>load</sub></a></li>
<li><a href="#sec-1-4">Aplicando funciones de la API a nuestro proyecto Drupal</a></li>
<li><a href="#sec-1-5">Views php</a></li>
<li><a href="#sec-1-6">Templates de nuestro tema instalado</a></li>
<li><a href="#sec-1-7">Templates de módulos instalados</a></li>
<li><a href="#sec-1-8">Templates que modifican views</a></li>
<li><a href="#sec-1-9">drupal\<sub>set\</sub><sub>message</sub></a></li>
<li><a href="#sec-1-10">node\<sub>save</sub></a></li>
<li><a href="#sec-1-11">user\<sub>save</sub></a></li>
<li><a href="#sec-1-12">watchdog</a></li>
<li><a href="#sec-1-13">t</a></li>
<li><a href="#sec-1-14">db\<sub>insert</sub></a></li>
<li><a href="#sec-1-15">db\<sub>update</sub></a></li>
<li><a href="#sec-1-16">db<sub>delete</sub></a></li>
<li><a href="#sec-1-17">db\<sub>transaction</sub></a></li>
</ul>
</li>
<li><a href="#sec-2">Desarrollo de Módulos</a>
<ul>
<li><a href="#sec-2-1">Arquitectura de los Módulos de Drupal</a></li>
<li><a href="#sec-2-2">Módulos del Núcleo</a></li>
<li><a href="#sec-2-3">Hooks</a></li>
<li><a href="#sec-2-4">Creación de Bloques</a></li>
<li><a href="#sec-2-5">Creando un fichero .info</a></li>
<li><a href="#sec-2-6">Un fichero .module</a></li>
<li><a href="#sec-2-7">Nuestro objetivo: Dos Block Hook</a></li>
<li><a href="#sec-2-8">Empezando el .module</a></li>
<li><a href="#sec-2-9">La implementación de hook\<sub>block\</sub><sub>info</sub>()</a></li>
</ul>
</li>
<li><a href="#sec-3">La implementación de hook\<sub>block\</sub><sub>view</sub>()</a>
<ul>
<li><a href="#sec-3-1">Instalación de Módulos</a></li>
<li><a href="#sec-3-2">Form API</a></li>
<li><a href="#sec-3-3">Formulario Básico</a></li>
<li><a href="#sec-3-4">Formulario Básico con Botón Submit</a></li>
<li><a href="#sec-3-5">Un formulario básico con fieldset</a></li>
<li><a href="#sec-3-6">Formulario Básico con Campos Obligatorios</a></li>
<li><a href="#sec-3-7">Formulario Básico con Atributos de Elementos Adicionales</a></li>
<li><a href="#sec-3-8">Formulario Básico con Manejador de la Validación</a></li>
<li><a href="#sec-3-9">Formulario con un manejador de submit</a></li>
<li><a href="#sec-3-10">Un Formulario de Múltiples Pasos</a></li>
<li><a href="#sec-3-11">Un Formulario con Campos Dinámicos</a></li>
<li><a href="#sec-3-12">Formulario para Subir un Fichero a Drupal</a></li>
<li><a href="#sec-3-13">Mail API</a></li>
<li><a href="#sec-3-14">drupal\<sub>mail</sub></a></li>
<li><a href="#sec-3-15">Creando Tipos de Contenido</a></li>
<li><a href="#sec-3-16">Por qué crear tus propias entidades</a></li>
<li><a href="#sec-3-17">El Objetivo</a></li>
<li><a href="#sec-3-18">Bundles</a></li>
<li><a href="#sec-3-19">El Esquema de la API</a></li>
</ul>
</li>
<li><a href="#sec-4">Licencia</a></li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">API de Drupal</h2>
<div class="outline-text-2" id="text-1">
<p>
Una API (del inglés Application Programming Interface) es un interfaz
para comunicar componentes de un sistema de software. Para cada
componente del sistema una API maneja la comunicación entre el
componente y el núcleo. Este método hace que los cambios en el
componente se aislen de los correspondientes cambios en el núcleo, de
este modo, se reducen los esfuerzos en depuración y pruebas a los
componentes únicamente.  En general, una API establece un estándar
para tratar con operaciones de bajo nivel e introducir estabilidad y
uniformidad en el código. El ejemplo más común de una API es la API de
la base de datos, que encapsula las operaciones de la base de datos
desde el núcleo, de tal modo que el núcleo funciona sin tener en
cuenta el gestor de base de datos que el sistema usa.  Ahora se verán
unos ejemplos de cómo podemos usar la api de drupal.
</p>
</div>

<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1">db\<sub>query</sub></h3>
<div class="outline-text-3" id="text-1-1">
<p>
Con db\<sub>query</sub> es posible hacer consultas select a la base de
datos. Ahora se verán las siguientes líneas de código:
</p>

<div class="org-src-container">

<pre class="src src-php"><span style="color: #483d8b;">&lt;?php</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">Drupal 7</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">Notice the place holders are now done using the same syntax as PDOs (:uid)</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">Placeholders also don't need to be quoted anymore.</span>
$<span style="color: #a0522d;">uid</span> = <span style="color: #000000; background-color: #ffffff;">1</span>;
$<span style="color: #a0522d;">result</span> = <span style="color: #000000; background-color: #ffffff;">db_query(</span><span style="color: #8b2252;">'SELECT n.nid, n.title, n.created</span>
<span style="color: #8b2252;">FROM {node} n WHERE n.uid = :uid'</span>, <span style="color: #000000; background-color: #ffffff;">array(</span><span style="color: #8b2252;">':uid'</span> =<span style="color: #008b8b;">&gt;</span> $<span style="color: #a0522d;">uid</span>));
<span style="color: #b22222;">// </span><span style="color: #b22222;">Result is returned as a iterable object that returns a stdClass object on each iteration</span>
<span style="color: #a020f0;">foreach</span> ($<span style="color: #a0522d;">result</span> <span style="color: #a020f0;">as</span> $<span style="color: #a0522d;">record</span>) {
 <span style="color: #b22222;">// </span><span style="color: #b22222;">Perform operations on $record-&gt;</span><span style="color: #a0522d;">title</span><span style="color: #b22222;">, etc. here.</span>
 <span style="color: #b22222;">// </span><span style="color: #b22222;">in this example the available data would be mapped to object properties:</span>
 <span style="color: #b22222;">// </span><span style="color: #b22222;">$record-&gt;</span><span style="color: #a0522d;">nid</span><span style="color: #b22222;">, $record-&gt;</span><span style="color: #a0522d;">title</span><span style="color: #b22222;">, $record-&gt;</span><span style="color: #a0522d;">created</span>
<span style="color: #000000; background-color: #ffffff;">print(</span>$<span style="color: #a0522d;">record</span>-&gt;<span style="color: #a0522d;">title</span>);
}
</pre>
</div>

<p>
Primero se fija el valor del argumento ($uid=1). Seguidamente se
ejecuta la consulta (se hace un select a la tabla node cuyo argumento
es el uid). Y finalmente, se recorren los resultados de la consulta
imprimiendo el título del nodo.  La llamada a la API de db\<sub>query</sub> es la
siguiente:
</p>

<div class="org-src-container">

<pre class="src src-php"><span style="color: #000000; background-color: #ffffff;">db_query(</span>$<span style="color: #a0522d;">query</span>, <span style="color: #228b22;">array</span> $<span style="color: #a0522d;">args</span> = <span style="color: #000000; background-color: #ffffff;">array(</span>), <span style="color: #228b22;">array</span> $<span style="color: #a0522d;">options</span> = <span style="color: #000000; background-color: #ffffff;">array(</span>))
<span style="color: #ff0000; font-weight: bold;">Parametros</span>:
$<span style="color: #a0522d;">query</span> <span style="color: #ff0000; font-weight: bold;">Es</span> <span style="color: #ff0000; font-weight: bold;">la</span> <span style="color: #ff0000; font-weight: bold;">sentencia</span> <span style="color: #ff0000; font-weight: bold;">de</span> <span style="color: #ff0000; font-weight: bold;">consulta</span> <span style="color: #ff0000; font-weight: bold;">lista</span> <span style="color: #ff0000; font-weight: bold;">para</span> <span style="color: #ff0000; font-weight: bold;">ejecutarse</span>. 
$<span style="color: #a0522d;">args</span> <span style="color: #ff0000; font-weight: bold;">Un</span> <span style="color: #ff0000; font-weight: bold;">array</span> <span style="color: #ff0000; font-weight: bold;">de</span> <span style="color: #ff0000; font-weight: bold;">valores</span> <span style="color: #ff0000; font-weight: bold;">para</span> <span style="color: #ff0000; font-weight: bold;">sustituir</span> <span style="color: #ff0000; font-weight: bold;">en</span> <span style="color: #ff0000; font-weight: bold;">la</span> <span style="color: #ff0000; font-weight: bold;">consulta</span>. 
$<span style="color: #a0522d;">options</span> <span style="color: #ff0000; font-weight: bold;">Un</span> <span style="color: #ff0000; font-weight: bold;">array</span> <span style="color: #ff0000; font-weight: bold;">de</span> <span style="color: #ff0000; font-weight: bold;">opciones</span> <span style="color: #ff0000; font-weight: bold;">para</span> <span style="color: #ff0000; font-weight: bold;">controlar</span> <span style="color: #ff0000; font-weight: bold;">como</span> <span style="color: #ff0000; font-weight: bold;">la</span> <span style="color: #ff0000; font-weight: bold;">consulta</span> <span style="color: #ff0000; font-weight: bold;">opera</span>.
<span style="color: #ff0000; font-weight: bold;">Valor</span> <span style="color: #ff0000; font-weight: bold;">devuelto</span>:
<span style="color: #ff0000; font-weight: bold;">DatabaseStatementInterface</span> <span style="color: #ff0000; font-weight: bold;">Un</span> <span style="color: #ff0000; font-weight: bold;">objeto</span> <span style="color: #ff0000; font-weight: bold;">sentencia</span> <span style="color: #ff0000; font-weight: bold;">ya</span> <span style="color: #ff0000; font-weight: bold;">ejecutado</span>.
</pre>
</div>

<p>
Es posible consultar la api de db\<sub>query</sub>, para una descripción completa
de la función y sus argumentos.
</p>
</div>
</div>
<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2">node\<sub>load</sub></h3>
<div class="outline-text-3" id="text-1-2">
<p>
En general, para obtener un nodo desde un nid es más cómodo utilizar
node\<sub>load</sub> que carga un objeto nodo desde la base de datos. Ahora se
verá un ejemplo de código:
</p>

<div class="org-src-container">

<pre class="src src-php">$<span style="color: #a0522d;">nid</span> = <span style="color: #000000; background-color: #ffffff;">1</span>;
$<span style="color: #a0522d;">node</span> = <span style="color: #000000; background-color: #ffffff;">node_load(</span>$<span style="color: #a0522d;">nid</span>);                                 
<span style="color: #000000; background-color: #ffffff;">print(</span>$<span style="color: #a0522d;">node</span>-&gt;<span style="color: #a0522d;">title</span>);
</pre>
</div>

<p>
Primero se fija el valor del argumento ($nid=1). Seguidamente se carga
el nodo cuyo nid es $nid en $node. Y, finalmente, se imprime el título
del nodo o lo que se quiera.  La llamada a la API de node\<sub>load</sub> es la
siguiente:
</p>

<div class="org-src-container">

<pre class="src src-php"><span style="color: #000000; background-color: #ffffff;">node_load(</span>$<span style="color: #a0522d;">nid</span> = <span style="color: #008b8b;">NULL</span>, $<span style="color: #a0522d;">vid</span> = <span style="color: #008b8b;">NULL</span>, $<span style="color: #a0522d;">reset</span> = <span style="color: #008b8b;">FALSE</span>) 
<span style="color: #ff0000; font-weight: bold;">Carga</span> <span style="color: #ff0000; font-weight: bold;">un</span> <span style="color: #ff0000; font-weight: bold;">objeto</span> <span style="color: #ff0000; font-weight: bold;">nodo</span> <span style="color: #ff0000; font-weight: bold;">desde</span> <span style="color: #ff0000; font-weight: bold;">la</span> <span style="color: #ff0000; font-weight: bold;">base</span> <span style="color: #ff0000; font-weight: bold;">de</span> <span style="color: #ff0000; font-weight: bold;">datos</span>.
<span style="color: #ff0000; font-weight: bold;">Par&#225;metros</span>
$<span style="color: #a0522d;">nid</span> <span style="color: #ff0000; font-weight: bold;">El</span> <span style="color: #ff0000; font-weight: bold;">ID</span> <span style="color: #ff0000; font-weight: bold;">del</span> <span style="color: #ff0000; font-weight: bold;">nodo</span>.
$<span style="color: #a0522d;">vid</span> <span style="color: #ff0000; font-weight: bold;">El</span> <span style="color: #ff0000; font-weight: bold;">ID</span> <span style="color: #ff0000; font-weight: bold;">de</span> <span style="color: #ff0000; font-weight: bold;">la</span> <span style="color: #ff0000; font-weight: bold;">revisi&#243;n</span> <span style="color: #ff0000; font-weight: bold;">del</span> <span style="color: #ff0000; font-weight: bold;">nodo</span>.
$<span style="color: #a0522d;">reset</span> <span style="color: #ff0000; font-weight: bold;">Si</span> <span style="color: #ff0000; font-weight: bold;">resetear</span> <span style="color: #ff0000; font-weight: bold;">la</span> <span style="color: #ff0000; font-weight: bold;">cache</span> <span style="color: #ff0000; font-weight: bold;">node_load_multiple</span>.
<span style="color: #ff0000; font-weight: bold;">Valor</span> <span style="color: #ff0000; font-weight: bold;">devuelto</span>
<span style="color: #ff0000; font-weight: bold;">Un</span> <span style="color: #ff0000; font-weight: bold;">objeto</span> <span style="color: #ff0000; font-weight: bold;">nodo</span> <span style="color: #ff0000; font-weight: bold;">completamente</span> <span style="color: #ff0000; font-weight: bold;">poblado</span>.
</pre>
</div>

<p>
Es posible consultar la <a href="http://api.drupal.org/api/drupal/modules--node--node.module/function/node_load/7">api de node\<sub>load</sub></a>, para una descripción
completa de la función y sus argumentos.
</p>
</div>
</div>
<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3">user\<sub>load</sub></h3>
<div class="outline-text-3" id="text-1-3">
<p>
De la misma manera, que no se suele usar db\<sub>query</sub> para cargar nodos,
tampoco lo usamos para cargar usuarios. user\<sub>load</sub> carga un objeto
usuario de la base de datos.  Ahora se verá un ejemplo de código:
</p>

<div class="org-src-container">

<pre class="src src-php">$<span style="color: #a0522d;">uid</span> = <span style="color: #000000; background-color: #ffffff;">1</span>;
$<span style="color: #a0522d;">account</span> = <span style="color: #000000; background-color: #ffffff;">user_load(</span>$<span style="color: #a0522d;">uid</span>);                                 
<span style="color: #000000; background-color: #ffffff;">print(</span>$<span style="color: #a0522d;">account</span>-&gt;<span style="color: #a0522d;">name</span>);
</pre>
</div>

<p>
Primero se fija el valor del argumento ($uid=1). Seguidamente se carga
el usuario cuyo uid es $uid en la tabla users. Y, finalmente, se
imprime el nombre del usuario o lo que se necesite.  
</p>

<p>
La llamada a la API de node\<sub>load</sub> es la siguiente:
</p>

<div class="org-src-container">

<pre class="src src-php"><span style="color: #000000; background-color: #ffffff;">user_load(</span>$<span style="color: #a0522d;">uid</span>, $<span style="color: #a0522d;">reset</span> = <span style="color: #008b8b;">FALSE</span>) 

<span style="color: #ff0000; font-weight: bold;">Carga</span> <span style="color: #ff0000; font-weight: bold;">un</span> <span style="color: #ff0000; font-weight: bold;">objeto</span> <span style="color: #ff0000; font-weight: bold;">usuario</span> <span style="color: #ff0000; font-weight: bold;">Drupal</span> <span style="color: #ff0000; font-weight: bold;">tiene</span> <span style="color: #ff0000; font-weight: bold;">un</span> <span style="color: #ff0000; font-weight: bold;">objeto</span> <span style="color: #000000; background-color: #ffffff;">usuario (</span>$<span style="color: #a0522d;">user</span>) <span style="color: #a020f0;">global</span>,
<span style="color: #ff0000; font-weight: bold;">que</span> <span style="color: #ff0000; font-weight: bold;">representa</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #ff0000; font-weight: bold;">usuario</span> <span style="color: #ff0000; font-weight: bold;">logado</span> <span style="color: #ff0000; font-weight: bold;">actualmente</span>. <span style="color: #ff0000; font-weight: bold;">Para</span> <span style="color: #ff0000; font-weight: bold;">evitar</span> <span style="color: #ff0000; font-weight: bold;">confusi&#243;n</span> <span style="color: #ff0000; font-weight: bold;">es</span>
<span style="color: #ff0000; font-weight: bold;">una</span> <span style="color: #ff0000; font-weight: bold;">buena</span> <span style="color: #ff0000; font-weight: bold;">idea</span> <span style="color: #ff0000; font-weight: bold;">asignar</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #ff0000; font-weight: bold;">resultado</span> <span style="color: #ff0000; font-weight: bold;">de</span> <span style="color: #ff0000; font-weight: bold;">esta</span> <span style="color: #ff0000; font-weight: bold;">funci&#243;n</span> <span style="color: #ff0000; font-weight: bold;">a</span> <span style="color: #ff0000; font-weight: bold;">un</span> <span style="color: #ff0000; font-weight: bold;">variable</span>
<span style="color: #ff0000; font-weight: bold;">local</span> <span style="color: #ff0000; font-weight: bold;">diferente</span>, <span style="color: #228b22;">generalmente</span> $<span style="color: #a0522d;">account</span>. 

<span style="color: #ff0000; font-weight: bold;">Si</span> <span style="color: #ff0000; font-weight: bold;">tu</span> <span style="color: #ff0000; font-weight: bold;">quieres</span> <span style="color: #ff0000; font-weight: bold;">actuar</span> <span style="color: #ff0000; font-weight: bold;">como</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #ff0000; font-weight: bold;">usuario</span> <span style="color: #ff0000; font-weight: bold;">que</span> <span style="color: #ff0000; font-weight: bold;">est&#225;s</span> <span style="color: #ff0000; font-weight: bold;">cargando</span>, <span style="color: #ff0000; font-weight: bold;">es</span> <span style="color: #ff0000; font-weight: bold;">esencial</span>
<span style="color: #ff0000; font-weight: bold;">llamar</span> <span style="color: #ff0000; font-weight: bold;">primero</span> <span style="color: #ff0000; font-weight: bold;">a</span>: 

<span style="color: #483d8b;">&lt;?php</span> <span style="color: #000000; background-color: #ffffff;">drupal_save_session(</span><span style="color: #008b8b;">FALSE</span>); <span style="color: #483d8b;">?&gt;</span> 

<span style="color: #ff0000; font-weight: bold;">Parametros</span> $<span style="color: #a0522d;">uid</span> <span style="color: #ff0000; font-weight: bold;">Entero</span> <span style="color: #ff0000; font-weight: bold;">especificando</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #ff0000; font-weight: bold;">ID</span> <span style="color: #ff0000; font-weight: bold;">del</span> <span style="color: #ff0000; font-weight: bold;">usuario</span> <span style="color: #ff0000; font-weight: bold;">a</span> <span style="color: #ff0000; font-weight: bold;">cargar</span>.
$<span style="color: #a0522d;">reset</span> <span style="color: #008b8b;">TRUE</span> <span style="color: #ff0000; font-weight: bold;">para</span> <span style="color: #ff0000; font-weight: bold;">resetear</span> <span style="color: #ff0000; font-weight: bold;">la</span> <span style="color: #ff0000; font-weight: bold;">cache</span> <span style="color: #ff0000; font-weight: bold;">interna</span> <span style="color: #ff0000; font-weight: bold;">y</span> <span style="color: #ff0000; font-weight: bold;">cargar</span> <span style="color: #ff0000; font-weight: bold;">desde</span> <span style="color: #ff0000; font-weight: bold;">la</span> <span style="color: #ff0000; font-weight: bold;">base</span> <span style="color: #ff0000; font-weight: bold;">de</span>
<span style="color: #ff0000; font-weight: bold;">datos</span>; <span style="color: #008b8b;">FALSE</span> (<span style="color: #ff0000; font-weight: bold;">por</span> <span style="color: #ff0000; font-weight: bold;">defecto</span>) <span style="color: #ff0000; font-weight: bold;">para</span> <span style="color: #ff0000; font-weight: bold;">cargar</span> <span style="color: #ff0000; font-weight: bold;">desde</span> <span style="color: #ff0000; font-weight: bold;">la</span> <span style="color: #ff0000; font-weight: bold;">cach&#233;</span> <span style="color: #ff0000; font-weight: bold;">interna</span>, <span style="color: #ff0000; font-weight: bold;">si</span> <span style="color: #ff0000; font-weight: bold;">est&#225;</span>
<span style="color: #ff0000; font-weight: bold;">asignada</span>.  <span style="color: #ff0000; font-weight: bold;">Valor</span> <span style="color: #ff0000; font-weight: bold;">devuelto</span> <span style="color: #ff0000; font-weight: bold;">Un</span> <span style="color: #ff0000; font-weight: bold;">objeto</span> <span style="color: #ff0000; font-weight: bold;">usuario</span> <span style="color: #ff0000; font-weight: bold;">completamente</span> <span style="color: #ff0000; font-weight: bold;">cargado</span> <span style="color: #ff0000; font-weight: bold;">si</span>
<span style="color: #ff0000; font-weight: bold;">ha</span> <span style="color: #ff0000; font-weight: bold;">habido</span> <span style="color: #ff0000; font-weight: bold;">&#233;xito</span> <span style="color: #ff0000; font-weight: bold;">en</span> <span style="color: #ff0000; font-weight: bold;">la</span> <span style="color: #ff0000; font-weight: bold;">carga</span>, <span style="color: #ff0000; font-weight: bold;">si</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #ff0000; font-weight: bold;">usuario</span> <span style="color: #ff0000; font-weight: bold;">no</span> <span style="color: #ff0000; font-weight: bold;">pudo</span> <span style="color: #ff0000; font-weight: bold;">ser</span> <span style="color: #ff0000; font-weight: bold;">cargado</span>
<span style="color: #ff0000; font-weight: bold;">devuelve</span> <span style="color: #008b8b;">FALSE</span>.
</pre>
</div>

<p>
Es posible consultar la api de <a href="http://api.drupal.org/api/drupal/modules--user--user.module/function/user_load/7">user\<sub>load</sub></a>, para una descripción
completa de la función y sus argumentos.
</p>
</div>
</div>
<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4">Aplicando funciones de la API a nuestro proyecto Drupal</h3>
<div class="outline-text-3" id="text-1-4">
<p>
Ahora veamos como aplicar las funciones aprendidas a nuestro proyecto
Drupal. Podemos hacerlo desde varias partes:
</p>

<ul class="org-ul">
<li>Customfield php de views
</li>
<li>Templates de nuestro tema instalado
</li>
<li>Templates de módulos instalados
</li>
<li>Templates que modifican views
</li>
<li>Módulos nuevos
</li>
<li>Desde contenidos ó bloques con el filtro php activo
</li>
</ul>

<p>
La parte de nuevos módulos lo abordaremos en el próximo capítulo, pero
el resto de hacks que podemos hacer a drupal sí es interesante verlo
desde aquí.
</p>
</div>
</div>
<div id="outline-container-sec-1-5" class="outline-3">
<h3 id="sec-1-5">Views php</h3>
<div class="outline-text-3" id="text-1-5">
<p>
Para tener esta funcionalidad es necesario tener instalado el módulo
views php. Este módulo te permite insertar código php en un campo de
views. Veamos cómo con un ejemplo.  
</p>

<p>
Dada la siguiente vista:
</p>


<div class="figure">
<p><img src="file:///home/davidam/Imágenes/drupal1.png" alt="drupal1.png" />
</p>
</div>

<p>
Pulsamos en + en el apartado "Fields". Encontramos un desplegable de
categorías de fields y seleccionamos "Global".
</p>


<div class="figure">
<p><img src="file:///home/davidam/Imágenes/drupal2.png" alt="drupal2.png" />
</p>
</div>

<p>
Y ahí elegimos "Global PHP" y pulsamos "Agregar". En la siguiente
pantalla encontramos un montón de opciones y vamos hasta "Value Code"
y pulsamos en "AVAILABLE VARIABLES" para ver las variables que tenemos
disponibles.
</p>

<p>
Ahora es el momento de recordar user<sub>load</sub> y ver que la variable
disponible $row-&gt;uid nos puede servir como valor de entrada. De este
modo, se introduce el siguiente código y se pulsa en actualizar:
</p>

<div class="org-src-container">

<pre class="src src-php">$<span style="color: #a0522d;">account</span> = <span style="color: #000000; background-color: #ffffff;">user_load(</span>$<span style="color: #a0522d;">row</span>-&gt;<span style="color: #a0522d;">uid</span>);
<span style="color: #a020f0;">return</span> $<span style="color: #a0522d;">account</span>-&gt;<span style="color: #a0522d;">name</span>;
</pre>
</div>

<p>
Luego es necesario salvar la vista, teniendo un display de página ó de
bloque.
</p>

<p>
Este ejemplo podría (y debe) ser fácilmente implementado usando
views. Pero ilustra muy bien el poder de views php. Una necesidad real
donde usar views php podría ser lo siguiente:
</p>

<div class="org-src-container">

<pre class="src src-php"><span style="color: #a020f0;">global</span> $<span style="color: #a0522d;">user</span>;
<span style="color: #a020f0;">if</span> ($<span style="color: #a0522d;">user</span>-&gt;<span style="color: #a0522d;">uid</span> == $<span style="color: #a0522d;">row</span>-&gt;<span style="color: #a0522d;">uid</span>)
{
<span style="color: #a020f0;">print</span> <span style="color: #8b2252;">'[buttons]'</span>;
}
</pre>
</div>

<p>
Este código imprime algo específico (por ejemplo, botones) cuando el
usuario logado coincide con el usuario de la fila de nuestra vista.
</p>
</div>
</div>
<div id="outline-container-sec-1-6" class="outline-3">
<h3 id="sec-1-6">Templates de nuestro tema instalado</h3>
<div class="outline-text-3" id="text-1-6">
<p>
Otra situación en la que se puede querer aplicar nuestros
conocimientos de la API. Es modificando algún template del tema que
está activo ó que se ha desarrollado para el proyecto actual.
</p>

<p>
Es posible que por alguna razón un cliente pida que después del
contenido de un nodo aparezca el nombre del administrador del sitio
(cuyo uid es 1). En el caso de que el tema activo fuera barlik
abriríamos el siguiente fichero:
"themes/bartik/templates/node.tpl.php" y debajo de print
render($content); se introducirían las líneas de código relativas a la
función user<sub>load</sub> que ya hemos visto. Quedando todo del siguiente
modo:
</p>

<div class="org-src-container">

<pre class="src src-php">...
  <span style="color: #008b8b;">&lt;div</span> <span style="color: #008b8b;">class=</span><span style="color: #8b2252;">"content clearfix"</span><span style="color: #483d8b;">&lt;?php</span> <span style="color: #a020f0;">print</span> $<span style="color: #a0522d;">content_attributes</span>; <span style="color: #483d8b;">?&gt;</span>&gt;                                                           
    <span style="color: #483d8b;">&lt;?php</span>                                                                                                                     
      <span style="color: #b22222;">// </span><span style="color: #b22222;">We hide the comments and links now so that we can render them later.                                                 </span>
      <span style="color: #000000; background-color: #ffffff;">hide(</span>$<span style="color: #a0522d;">content</span>[<span style="color: #8b2252;">'comments'</span>]);                                                                                             
      <span style="color: #000000; background-color: #ffffff;">hide(</span>$<span style="color: #a0522d;">content</span>[<span style="color: #8b2252;">'links'</span>]);                                                                                                
      <span style="color: #a020f0;">print</span> <span style="color: #000000; background-color: #ffffff;">render(</span>$<span style="color: #a0522d;">content</span>);                                                                                                 
    <span style="color: #483d8b;">?&gt;</span>                                                                                                                        
    <span style="color: #483d8b;">&lt;?php</span>                                                                                                                     
$<span style="color: #a0522d;">uid</span> = <span style="color: #000000; background-color: #ffffff;">1</span>;                                                                                                                     
$<span style="color: #a0522d;">account</span> = <span style="color: #000000; background-color: #ffffff;">user_load(</span>$<span style="color: #a0522d;">uid</span>);                                                                                                   
<span style="color: #000000; background-color: #ffffff;">print(</span>$<span style="color: #a0522d;">account</span>-<span style="color: #008b8b;">&gt;</span><span style="color: #a0522d;">name</span>);                                                                                                        
    <span style="color: #483d8b;">?&gt;</span>                                                                                                                        
  <span style="color: #008b8b;">&lt;/div&gt;</span>                                                                                                                      

  <span style="color: #483d8b;">&lt;?php</span>     
...
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-7" class="outline-3">
<h3 id="sec-1-7">Templates de módulos instalados</h3>
<div class="outline-text-3" id="text-1-7">
<p>
Modificar templates de módulos instalados es similar a lo visto en el
anterior apartado. Tan solo es necesario localizar el template del
módulo que se pretende modificar, copiarlo en la carpeta del tema y
hacer allí las modificaciones pertinentes.
</p>
</div>
</div>
<div id="outline-container-sec-1-8" class="outline-3">
<h3 id="sec-1-8">Templates que modifican views</h3>
<div class="outline-text-3" id="text-1-8">
<p>
Si desde una vista se pulsa a Style settings -&gt; Theme se ven los
diferentes nombres con los que es posible reescribir las plantillas
relacionadas con views. Una vez elegida la plantilla a reescribir, se
introduce el fichero en la carpeta del tema.
</p>

<p>
Ahora que ya se sabe donde aplicar la api, se puede seguir aprendiendo
nuevas funciones.
</p>
</div>
</div>
<div id="outline-container-sec-1-9" class="outline-3">
<h3 id="sec-1-9">drupal\<sub>set\</sub><sub>message</sub></h3>
<div class="outline-text-3" id="text-1-9">
<p>
Imprime un mensaje, normalmente con la acción que se acaba de
realizar. Un ejemplo:
</p>

<div class="org-src-container">

<pre class="src src-php"><span style="color: #483d8b;">&lt;?php</span>
<span style="color: #000000; background-color: #ffffff;">drupal_set_message(</span><span style="color: #8b2252;">'Aprendiendo a usar drupal_set_message'</span>);
<span style="color: #483d8b;">?&gt;</span>
</pre>
</div>

<p>
Este código hace aparecer la frase "Aprendiendo a usar
drupal\<sub>set\</sub><sub>message</sub>" formateado como mensaje drupal, normalmente dentro
de una caja verde.
</p>

<p>
La llamada a la API de drupal<sub>set</sub><sub>message</sub> es la siguiente:
</p>

<div class="org-src-container">

<pre class="src src-php"><span style="color: #000000; background-color: #ffffff;">drupal_set_message(</span>$<span style="color: #a0522d;">message</span> = <span style="color: #008b8b;">NULL</span>, $<span style="color: #a0522d;">type</span> = <span style="color: #8b2252;">'status'</span>, $<span style="color: #a0522d;">repeat</span> = <span style="color: #008b8b;">TRUE</span>)
<span style="color: #ff0000; font-weight: bold;">Par&#225;metros</span>
$<span style="color: #a0522d;">message</span> <span style="color: #ff0000; font-weight: bold;">El</span> <span style="color: #ff0000; font-weight: bold;">mensaje</span> <span style="color: #ff0000; font-weight: bold;">empieza</span> <span style="color: #ff0000; font-weight: bold;">con</span> <span style="color: #ff0000; font-weight: bold;">una</span> <span style="color: #ff0000; font-weight: bold;">may&#250;scula</span> <span style="color: #ff0000; font-weight: bold;">y</span> <span style="color: #ff0000; font-weight: bold;">finaliza</span> <span style="color: #ff0000; font-weight: bold;">con</span> <span style="color: #ff0000; font-weight: bold;">un</span> <span style="color: #ff0000; font-weight: bold;">punto</span>.
$<span style="color: #a0522d;">type</span> <span style="color: #ff0000; font-weight: bold;">El</span> <span style="color: #ff0000; font-weight: bold;">tipo</span> <span style="color: #ff0000; font-weight: bold;">de</span> <span style="color: #ff0000; font-weight: bold;">mensaje</span>. <span style="color: #ff0000; font-weight: bold;">Uno</span> <span style="color: #ff0000; font-weight: bold;">de</span> <span style="color: #ff0000; font-weight: bold;">los</span> <span style="color: #ff0000; font-weight: bold;">siguientes</span> <span style="color: #ff0000; font-weight: bold;">valores</span> <span style="color: #ff0000; font-weight: bold;">es</span> <span style="color: #ff0000; font-weight: bold;">posible</span>:
+ <span style="color: #8b2252;">'status'</span> 
+ <span style="color: #8b2252;">'warning'</span> 
+ <span style="color: #8b2252;">'error'</span> 
$<span style="color: #a0522d;">repeat</span> <span style="color: #ff0000; font-weight: bold;">Si</span> <span style="color: #ff0000; font-weight: bold;">esto</span> <span style="color: #ff0000; font-weight: bold;">es</span> <span style="color: #008b8b;">FALSE</span> <span style="color: #ff0000; font-weight: bold;">y</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #ff0000; font-weight: bold;">mensaje</span> <span style="color: #ff0000; font-weight: bold;">ha</span> <span style="color: #ff0000; font-weight: bold;">sido</span> <span style="color: #ff0000; font-weight: bold;">asignado</span>, <span style="color: #ff0000; font-weight: bold;">entonces</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #ff0000; font-weight: bold;">mensaje</span> <span style="color: #ff0000; font-weight: bold;">no</span> <span style="color: #ff0000; font-weight: bold;">ser&#225;</span> <span style="color: #ff0000; font-weight: bold;">repetido</span>.
</pre>
</div>

<p>
Es posible consultar la <i>drupal<sub>set</sub><sub>message</sub></i>, para una descripción
completa de la función y sus argumentos.
</p>
</div>
</div>
<div id="outline-container-sec-1-10" class="outline-3">
<h3 id="sec-1-10">node\<sub>save</sub></h3>
<div class="outline-text-3" id="text-1-10">
<p>
Graba un objeto nodo en la base de datos ó añade un nuevo nodo. Ahora
se verá un ejemplo de código:
</p>

<div class="org-src-container">

<pre class="src src-php"><span style="color: #483d8b;">&lt;?php</span>
$<span style="color: #a0522d;">node</span> = <span style="color: #000000; background-color: #ffffff;">node_load(1</span>); <span style="color: #b22222;">// </span><span style="color: #b22222;">load node</span>
$<span style="color: #a0522d;">node</span>-<span style="color: #008b8b;">&gt;</span><span style="color: #a0522d;">title</span> = <span style="color: #8b2252;">'nah, nah, nah, nah, boo, boo'</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">Do some changes</span>
<span style="color: #000000; background-color: #ffffff;">node_save(</span>$<span style="color: #a0522d;">node</span>); <span style="color: #b22222;">// </span><span style="color: #b22222;">save your changes</span>
<span style="color: #000000; background-color: #ffffff;">drupal_set_message(</span><span style="color: #8b2252;">'Updated'</span>);
<span style="color: #483d8b;">?&gt;</span>
</pre>
</div>

<p>
En el ejemplo se puebla un objeto nodo cuyo nid es 1. Se establece un
título cualquiera. Se guarda el nodo modificado en la base de datos. Y
finalmente se imprime el mensaje "Updated".
</p>

<p>
La llamada a la API de node<sub>save</sub> es la siguiente:
</p>

<div class="org-src-container">

<pre class="src src-php"><span style="color: #000000; background-color: #ffffff;">node_save(</span>$<span style="color: #a0522d;">node</span>) 

<span style="color: #ff0000; font-weight: bold;">Par&#225;metros</span> $<span style="color: #a0522d;">node</span> <span style="color: #ff0000; font-weight: bold;">El</span> <span style="color: #ff0000; font-weight: bold;">objeto</span> $<span style="color: #a0522d;">node</span> <span style="color: #ff0000; font-weight: bold;">que</span> <span style="color: #ff0000; font-weight: bold;">va</span> <span style="color: #ff0000; font-weight: bold;">a</span> <span style="color: #ff0000; font-weight: bold;">ser</span> <span style="color: #ff0000; font-weight: bold;">guardado</span>. <span style="color: #ff0000; font-weight: bold;">Si</span> $<span style="color: #a0522d;">node</span>-&gt;<span style="color: #a0522d;">nid</span>
<span style="color: #ff0000; font-weight: bold;">es</span> <span style="color: #000000; background-color: #ffffff;">omitido (</span><span style="color: #228b22;">o</span> $<span style="color: #a0522d;">node</span>-&gt;<span style="color: #a0522d;">is_new</span> <span style="color: #ff0000; font-weight: bold;">es</span> <span style="color: #008b8b;">TRUE</span>), <span style="color: #ff0000; font-weight: bold;">un</span> <span style="color: #ff0000; font-weight: bold;">nuevo</span> <span style="color: #ff0000; font-weight: bold;">nodo</span> <span style="color: #ff0000; font-weight: bold;">ser&#225;</span> <span style="color: #ff0000; font-weight: bold;">a&#241;adido</span>.
</pre>
</div>

<p>
Es posible consultar la <a href="http://api.drupal.org/api/drupal/modules--node--node.module/function/node_save/7">api de node<sub>save</sub></a> para una descripción
completa de la función y sus argumentos.
</p>
</div>
</div>
<div id="outline-container-sec-1-11" class="outline-3">
<h3 id="sec-1-11">user\<sub>save</sub></h3>
<div class="outline-text-3" id="text-1-11">
<p>
De la misma manera que escribimos las modificaciones a un nodo en base
de datos, es posible escribir en base de datos las modificaciones a un
usuario. Se presentan un par de ejemplos:
</p>

<div class="org-src-container">

<pre class="src src-php"><span style="color: #483d8b;">&lt;?php</span>
$<span style="color: #a0522d;">account</span> = <span style="color: #000000; background-color: #ffffff;">user_load(1</span>); <span style="color: #b22222;">// </span><span style="color: #b22222;">load node</span>
<span style="color: #000000; background-color: #ffffff;">user_save(</span>$<span style="color: #a0522d;">account</span>, <span style="color: #000000; background-color: #ffffff;">array(</span><span style="color: #8b2252;">'name'</span> =<span style="color: #008b8b;">&gt;</span> <span style="color: #8b2252;">'John Smith'</span>)); <span style="color: #b22222;">// </span><span style="color: #b22222;">save your changes</span>
<span style="color: #000000; background-color: #ffffff;">drupal_set_message(</span><span style="color: #8b2252;">'Updated'</span>);
<span style="color: #483d8b;">?&gt;</span>
</pre>
</div>

<p>
Este ejemplo es bastante similar al de node<sub>save</sub>: tras cargar el
usuario, las modificaciones se realizan al nombre del usuario y se
salvan los datos. Ahora el siguiente ejemplo:
</p>

<div class="org-src-container">

<pre class="src src-php"><span style="color: #483d8b;">&lt;?php</span>
$<span style="color: #a0522d;">details</span> = <span style="color: #000000; background-color: #ffffff;">array(</span>
 <span style="color: #8b2252;">'name'</span> =<span style="color: #008b8b;">&gt;</span> <span style="color: #8b2252;">'John Smith'</span>,
 <span style="color: #8b2252;">'pass'</span> =&gt; <span style="color: #8b2252;">'sssh es un secreto'</span>,
 <span style="color: #8b2252;">'mail'</span> =&gt; <span style="color: #8b2252;">'john@smith.com'</span>,
 <span style="color: #8b2252;">'access'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">0</span>, <span style="color: #b22222;">/* </span><span style="color: #b22222;">optional, i didnt want user to be able to this this account yet</span><span style="color: #b22222;">*/</span>
 <span style="color: #8b2252;">'status'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">1</span>
;
$<span style="color: #a0522d;">user</span> = <span style="color: #000000; background-color: #ffffff;">user_save(</span><span style="color: #008b8b;">null</span>, $<span style="color: #a0522d;">details</span>);
<span style="color: #483d8b;">?&gt;</span>
</pre>
</div>

<p>
En este ejemplo se usa user<sub>save</sub> para crear usuarios nuevos, que es
otro de los usos de esta función, los valores se definen en el array
$details.
</p>

<p>
La llamada a la API de user<sub>save</sub> es la siguiente:
</p>

<div class="org-src-container">

<pre class="src src-php"><span style="color: #000000; background-color: #ffffff;">user_save(</span>$<span style="color: #a0522d;">account</span>, $<span style="color: #a0522d;">edit</span> = <span style="color: #000000; background-color: #ffffff;">array(</span>), $<span style="color: #a0522d;">category</span> = <span style="color: #8b2252;">'account'</span>) 
<span style="color: #ff0000; font-weight: bold;">Par&#225;metros</span>
$<span style="color: #a0522d;">account</span> (<span style="color: #ff0000; font-weight: bold;">opcional</span>) <span style="color: #ff0000; font-weight: bold;">El</span> <span style="color: #ff0000; font-weight: bold;">objeto</span> <span style="color: #ff0000; font-weight: bold;">de</span> <span style="color: #ff0000; font-weight: bold;">usuario</span> <span style="color: #ff0000; font-weight: bold;">para</span> <span style="color: #ff0000; font-weight: bold;">modificar</span> <span style="color: #ff0000; font-weight: bold;">&#243;</span> <span style="color: #ff0000; font-weight: bold;">a&#241;adir</span>. <span style="color: #ff0000; font-weight: bold;">Si</span> <span style="color: #ff0000; font-weight: bold;">se</span> <span style="color: #ff0000; font-weight: bold;">desea</span> <span style="color: #ff0000; font-weight: bold;">modificar</span> <span style="color: #ff0000; font-weight: bold;">una</span> <span style="color: #ff0000; font-weight: bold;">cuenta</span> <span style="color: #ff0000; font-weight: bold;">de</span> <span style="color: #ff0000; font-weight: bold;">usuario</span> <span style="color: #ff0000; font-weight: bold;">existente</span>, <span style="color: #ff0000; font-weight: bold;">se</span> <span style="color: #ff0000; font-weight: bold;">necesitar&#225;</span> <span style="color: #ff0000; font-weight: bold;">asegurar</span> <span style="color: #000000; background-color: #ffffff;">que (</span><span style="color: #ff0000; font-weight: bold;">a</span>) $<span style="color: #a0522d;">account</span> <span style="color: #ff0000; font-weight: bold;">es</span> <span style="color: #ff0000; font-weight: bold;">un</span> <span style="color: #ff0000; font-weight: bold;">objeto</span>, <span style="color: #000000; background-color: #ffffff;">y (</span><span style="color: #ff0000; font-weight: bold;">b</span>) <span style="color: #ff0000; font-weight: bold;">se</span> <span style="color: #ff0000; font-weight: bold;">ha</span> <span style="color: #ff0000; font-weight: bold;">asignado</span> $<span style="color: #a0522d;">account</span>-&gt;<span style="color: #a0522d;">uid</span> <span style="color: #ff0000; font-weight: bold;">al</span> <span style="color: #ff0000; font-weight: bold;">user</span> <span style="color: #ff0000; font-weight: bold;">ID</span> <span style="color: #ff0000; font-weight: bold;">de</span> <span style="color: #ff0000; font-weight: bold;">la</span> <span style="color: #ff0000; font-weight: bold;">cuenta</span> <span style="color: #ff0000; font-weight: bold;">de</span> <span style="color: #ff0000; font-weight: bold;">usuario</span> <span style="color: #ff0000; font-weight: bold;">a</span> <span style="color: #ff0000; font-weight: bold;">modificar</span>. <span style="color: #ff0000; font-weight: bold;">Si</span> <span style="color: #ff0000; font-weight: bold;">se</span> <span style="color: #ff0000; font-weight: bold;">desea</span> <span style="color: #ff0000; font-weight: bold;">crear</span> <span style="color: #ff0000; font-weight: bold;">una</span> <span style="color: #ff0000; font-weight: bold;">nueva</span> <span style="color: #ff0000; font-weight: bold;">cuenta</span> <span style="color: #ff0000; font-weight: bold;">de</span> <span style="color: #ff0000; font-weight: bold;">usuario</span>, <span style="color: #ff0000; font-weight: bold;">es</span> <span style="color: #ff0000; font-weight: bold;">posible</span> <span style="color: #ff0000; font-weight: bold;">establecer</span> $<span style="color: #a0522d;">account</span>-&gt;<span style="color: #a0522d;">is_new</span> <span style="color: #ff0000; font-weight: bold;">a</span> <span style="color: #008b8b;">TRUE</span> <span style="color: #ff0000; font-weight: bold;">u</span> <span style="color: #ff0000; font-weight: bold;">omitir</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #ff0000; font-weight: bold;">campo</span> $<span style="color: #a0522d;">account</span>-&gt;<span style="color: #a0522d;">uid</span>.
$<span style="color: #a0522d;">edit</span> <span style="color: #ff0000; font-weight: bold;">Un</span> <span style="color: #ff0000; font-weight: bold;">array</span> <span style="color: #ff0000; font-weight: bold;">de</span> <span style="color: #ff0000; font-weight: bold;">campos</span> <span style="color: #ff0000; font-weight: bold;">y</span> <span style="color: #ff0000; font-weight: bold;">valores</span> <span style="color: #ff0000; font-weight: bold;">a</span> <span style="color: #ff0000; font-weight: bold;">guardar</span>. <span style="color: #ff0000; font-weight: bold;">Por</span> <span style="color: #ff0000; font-weight: bold;">ejemplo</span>, <span style="color: #000000; background-color: #ffffff;">array(</span><span style="color: #8b2252;">'name'</span> =&gt; <span style="color: #8b2252;">'My name'</span>). <span style="color: #ff0000; font-weight: bold;">Pares</span> <span style="color: #ff0000; font-weight: bold;">clave</span> / <span style="color: #ff0000; font-weight: bold;">valor</span> <span style="color: #ff0000; font-weight: bold;">a&#241;adidas</span> <span style="color: #ff0000; font-weight: bold;">a</span> $<span style="color: #a0522d;">edit</span>[<span style="color: #8b2252;">'data'</span>] <span style="color: #ff0000; font-weight: bold;">ser&#225;n</span> <span style="color: #ff0000; font-weight: bold;">serializadas</span> <span style="color: #ff0000; font-weight: bold;">y</span> <span style="color: #ff0000; font-weight: bold;">guardadas</span> <span style="color: #ff0000; font-weight: bold;">en</span> <span style="color: #ff0000; font-weight: bold;">la</span> <span style="color: #ff0000; font-weight: bold;">columna</span> {<span style="color: #ff0000; font-weight: bold;">users</span>.<span style="color: #ff0000; font-weight: bold;">data</span>}.
$<span style="color: #a0522d;">category</span> (<span style="color: #ff0000; font-weight: bold;">optional</span>) <span style="color: #ff0000; font-weight: bold;">The</span> <span style="color: #ff0000; font-weight: bold;">category</span> <span style="color: #a020f0;">for</span> <span style="color: #ff0000; font-weight: bold;">storing</span> <span style="color: #ff0000; font-weight: bold;">profile</span> <span style="color: #ff0000; font-weight: bold;">information</span> <span style="color: #ff0000; font-weight: bold;">in</span>.
<span style="color: #ff0000; font-weight: bold;">Valor</span> <span style="color: #ff0000; font-weight: bold;">devuelto</span>
<span style="color: #ff0000; font-weight: bold;">Un</span> <span style="color: #ff0000; font-weight: bold;">objeto</span> $<span style="color: #a0522d;">user</span> <span style="color: #ff0000; font-weight: bold;">si</span> <span style="color: #ff0000; font-weight: bold;">hay</span> <span style="color: #ff0000; font-weight: bold;">&#233;xito</span> <span style="color: #ff0000; font-weight: bold;">y</span> <span style="color: #008b8b;">FALSE</span> <span style="color: #ff0000; font-weight: bold;">en</span> <span style="color: #ff0000; font-weight: bold;">caso</span> <span style="color: #ff0000; font-weight: bold;">contrario</span>.
</pre>
</div>

<p>
Es posible consultar la <a href="http://api.drupal.org/api/drupal/modules--user--user.module/function/user_save">api de user<sub>save</sub></a>, para una descripción
completa de la función y sus argumentos.
</p>
</div>
</div>
<div id="outline-container-sec-1-12" class="outline-3">
<h3 id="sec-1-12">watchdog</h3>
<div class="outline-text-3" id="text-1-12">
<p>
Hace un log de un mensaje de sistema. Ahora se verá un ejemplo de código:
</p>

<div class="org-src-container">

<pre class="src src-php"><span style="color: #483d8b;">&lt;?php</span>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">node_save_action</span>($<span style="color: #a0522d;">node</span>) {
  <span style="color: #000000; background-color: #ffffff;">node_save(</span>$<span style="color: #a0522d;">node</span>);
  <span style="color: #000000; background-color: #ffffff;">watchdog(</span><span style="color: #8b2252;">'action'</span>, <span style="color: #8b2252;">'Saved @type %title'</span>, <span style="color: #000000; background-color: #ffffff;">array(</span><span style="color: #8b2252;">'@type'</span> =<span style="color: #008b8b;">&gt;</span> <span style="color: #000000; background-color: #ffffff;">node_type_get_name(</span>$<span style="color: #a0522d;">node</span>), <span style="color: #8b2252;">'%title'</span> =&gt; $<span style="color: #a0522d;">node</span>-&gt;<span style="color: #a0522d;">title</span>));
}
<span style="color: #483d8b;">?&gt;</span>
</pre>
</div>

<p>
Antes de explicar el código veamos la declaración de la API:
</p>

<div class="org-src-container">

<pre class="src src-php"><span style="color: #000000; background-color: #ffffff;">watchdog(</span>$<span style="color: #a0522d;">type</span>, $<span style="color: #a0522d;">message</span>, $<span style="color: #a0522d;">variables</span> = <span style="color: #000000; background-color: #ffffff;">array(</span>), $<span style="color: #a0522d;">severity</span> = <span style="color: #ff0000; font-weight: bold;">WATCHDOG_NOTICE</span>, $<span style="color: #a0522d;">link</span> = <span style="color: #008b8b;">NULL</span>) 
<span style="color: #ff0000; font-weight: bold;">Par&#225;metros</span>
$<span style="color: #a0522d;">type</span> <span style="color: #ff0000; font-weight: bold;">La</span> <span style="color: #ff0000; font-weight: bold;">categor&#237;a</span> <span style="color: #ff0000; font-weight: bold;">al</span> <span style="color: #ff0000; font-weight: bold;">que</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #ff0000; font-weight: bold;">mensaje</span> <span style="color: #ff0000; font-weight: bold;">pertenece</span>. <span style="color: #ff0000; font-weight: bold;">Puede</span> <span style="color: #ff0000; font-weight: bold;">ser</span> <span style="color: #ff0000; font-weight: bold;">cualquier</span> <span style="color: #ff0000; font-weight: bold;">cadena</span>, <span style="color: #ff0000; font-weight: bold;">pero</span> <span style="color: #ff0000; font-weight: bold;">la</span> <span style="color: #ff0000; font-weight: bold;">pr&#225;ctica</span> <span style="color: #ff0000; font-weight: bold;">general</span> <span style="color: #ff0000; font-weight: bold;">es</span> <span style="color: #ff0000; font-weight: bold;">usar</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #ff0000; font-weight: bold;">nombre</span> <span style="color: #ff0000; font-weight: bold;">del</span> <span style="color: #ff0000; font-weight: bold;">m&#243;dulo</span> <span style="color: #ff0000; font-weight: bold;">llamando</span> <span style="color: #000000; background-color: #ffffff;">watchdog(</span>).
$<span style="color: #a0522d;">message</span> <span style="color: #ff0000; font-weight: bold;">El</span> <span style="color: #ff0000; font-weight: bold;">mensaje</span> <span style="color: #ff0000; font-weight: bold;">a</span> <span style="color: #ff0000; font-weight: bold;">almacenar</span> <span style="color: #ff0000; font-weight: bold;">en</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #ff0000; font-weight: bold;">log</span>. &#161;<span style="color: #ff0000; font-weight: bold;">Deja</span> <span style="color: #ff0000; font-weight: bold;">el</span> $<span style="color: #a0522d;">message</span> <span style="color: #ff0000; font-weight: bold;">traducible</span> <span style="color: #ff0000; font-weight: bold;">no</span> <span style="color: #ff0000; font-weight: bold;">concatenando</span> <span style="color: #ff0000; font-weight: bold;">valores</span> <span style="color: #ff0000; font-weight: bold;">din&#225;micos</span> <span style="color: #ff0000; font-weight: bold;">dentro</span> <span style="color: #ff0000; font-weight: bold;">de</span> <span style="color: #ff0000; font-weight: bold;">&#233;l</span>! 
$<span style="color: #a0522d;">variables</span> <span style="color: #ff0000; font-weight: bold;">Array</span> <span style="color: #ff0000; font-weight: bold;">de</span> <span style="color: #ff0000; font-weight: bold;">variables</span> <span style="color: #ff0000; font-weight: bold;">para</span> <span style="color: #ff0000; font-weight: bold;">reemplazar</span> <span style="color: #ff0000; font-weight: bold;">en</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #ff0000; font-weight: bold;">mensaje</span> <span style="color: #ff0000; font-weight: bold;">&#243;</span> <span style="color: #008b8b;">NULL</span> <span style="color: #ff0000; font-weight: bold;">si</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #ff0000; font-weight: bold;">mensaje</span> <span style="color: #ff0000; font-weight: bold;">ya</span> <span style="color: #ff0000; font-weight: bold;">est&#225;</span> <span style="color: #ff0000; font-weight: bold;">traducido</span> <span style="color: #ff0000; font-weight: bold;">&#243;</span> <span style="color: #ff0000; font-weight: bold;">no</span> <span style="color: #ff0000; font-weight: bold;">es</span> <span style="color: #ff0000; font-weight: bold;">posible</span> <span style="color: #ff0000; font-weight: bold;">traducirlo</span>
$<span style="color: #a0522d;">severity</span> <span style="color: #ff0000; font-weight: bold;">La</span> <span style="color: #ff0000; font-weight: bold;">gravedad</span> <span style="color: #ff0000; font-weight: bold;">del</span> <span style="color: #ff0000; font-weight: bold;">mensaje</span>, <span style="color: #ff0000; font-weight: bold;">dada</span> <span style="color: #ff0000; font-weight: bold;">en</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #ff0000; font-weight: bold;">RFC</span> <span style="color: #000000; background-color: #ffffff;">3164</span>. <span style="color: #ff0000; font-weight: bold;">Posibles</span> <span style="color: #ff0000; font-weight: bold;">valores</span> <span style="color: #ff0000; font-weight: bold;">son</span> <span style="color: #ff0000; font-weight: bold;">WATCHDOG_ERROR</span>, <span style="color: #ff0000; font-weight: bold;">WATCHDOG_WARNING</span>, <span style="color: #ff0000; font-weight: bold;">etc</span>.
$<span style="color: #a0522d;">link</span> <span style="color: #ff0000; font-weight: bold;">Un</span> <span style="color: #ff0000; font-weight: bold;">enlace</span> <span style="color: #ff0000; font-weight: bold;">asociado</span> <span style="color: #ff0000; font-weight: bold;">con</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #ff0000; font-weight: bold;">mensaje</span>.
</pre>
</div>

<p>
En nuestro ejemplo $type es "action", $message es "Saved @type
%tittle" y las variables type y title se obtienen mediante el array.
</p>

<p>
Es posible consultar la api de watchdog, para una descripción completa
de la función y sus argumentos.
</p>
</div>
</div>
<div id="outline-container-sec-1-13" class="outline-3">
<h3 id="sec-1-13">t</h3>
<div class="outline-text-3" id="text-1-13">
<p>
La función t facilita la traducción de cadenas en Drupal. Ahora se
verá un ejemplo de código:
</p>

<div class="org-src-container">

<pre class="src src-php"><span style="color: #483d8b;">&lt;?php</span>
<span style="color: #000000; background-color: #ffffff;">print(t(</span><span style="color: #8b2252;">'Hello World'</span>));
<span style="color: #483d8b;">?&gt;</span>
</pre>
</div>

<p>
Este código imprime la cadena "Hello world". Pero ahora la cadena
"Hello world" es traducible. Si se va a Configuración -&gt; Regional e
Idioma -&gt; Traducir Interfaz -&gt; Traducir podemos buscar la cadena
"Hello world" y traducirla por "Hola Mundo" en español.
</p>


<div class="figure">
<p><img src="file:///home/davidam/public_html/docu/drupal/pantallazo4.png" alt="pantallazo4.png" />
</p>
</div>

<p>
Ahora se verá otro ejemplo:
</p>

<div class="org-src-container">

<pre class="src src-php">$<span style="color: #a0522d;">uid</span> = <span style="color: #000000; background-color: #ffffff;">1</span>;
$<span style="color: #a0522d;">account</span> = <span style="color: #000000; background-color: #ffffff;">user_load(</span>$<span style="color: #a0522d;">uid</span>);
<span style="color: #000000; background-color: #ffffff;">print(t(</span><span style="color: #8b2252;">"@name's blog"</span>, <span style="color: #000000; background-color: #ffffff;">array(</span><span style="color: #8b2252;">'@name'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">format_username(</span>$<span style="color: #a0522d;">account</span>))));
</pre>
</div>

<p>
Como se ve es posible introducir variables en la cadena a traducir que
son definidas en el segundo argumento de t que es un array.  
</p>

<p>
La llamada a la API de t es la siguiente:
</p>

<div class="org-src-container">

<pre class="src src-php"><span style="color: #000000; background-color: #ffffff;">t(</span>$<span style="color: #a0522d;">string</span>, <span style="color: #228b22;">array</span> $<span style="color: #a0522d;">args</span> = <span style="color: #000000; background-color: #ffffff;">array(</span>), <span style="color: #228b22;">array</span> $<span style="color: #a0522d;">options</span> = <span style="color: #000000; background-color: #ffffff;">array(</span>))
</pre>
</div>

<p>
Es posible consultar la <a href="http://api.drupal.org/api/drupal/includes--bootstrap.inc/function/t/7">api de t</a>, para una descripción completa de la
función y sus argumentos.
</p>
</div>
</div>
<div id="outline-container-sec-1-14" class="outline-3">
<h3 id="sec-1-14">db\<sub>insert</sub></h3>
<div class="outline-text-3" id="text-1-14">
<p>
Esta función permite insertar registros en la base de datos. Ahora se
verá un ejemplo:
</p>

<div class="org-src-container">

<pre class="src src-php"><span style="color: #483d8b;">&lt;?php</span>
$<span style="color: #a0522d;">nid</span> = <span style="color: #000000; background-color: #ffffff;">db_insert(</span><span style="color: #8b2252;">'node'</span>) <span style="color: #b22222;">// </span><span style="color: #b22222;">Table name no longer needs {}</span>
-<span style="color: #008b8b;">&gt;</span><span style="color: #000000; background-color: #ffffff;">fields</span>(<span style="color: #000000; background-color: #ffffff;">array(</span>
<span style="color: #8b2252;">'title'</span> =&gt; <span style="color: #8b2252;">'Example'</span>,<span style="color: #8b2252;">'uid'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">1</span>, <span style="color: #8b2252;">'created'</span> =&gt; <span style="color: #ff0000; font-weight: bold;">REQUEST_TIME</span>,
))-&gt;<span style="color: #000000; background-color: #ffffff;">execute</span>();
</pre>
</div>

<p>
El código inserta un nuevo registro en la tabla node, con los
parámetros dados. Como se vé este código es alternativo a utilizar
node<sub>save</sub>. Ahora se verá la descripción de la llamada a la API.
</p>

<div class="org-src-container">

<pre class="src src-php"><span style="color: #000000; background-color: #ffffff;">db_insert(</span>$<span style="color: #a0522d;">table</span>, <span style="color: #228b22;">array</span> $<span style="color: #a0522d;">options</span> = <span style="color: #000000; background-color: #ffffff;">array(</span>)) 
<span style="color: #ff0000; font-weight: bold;">Devuelve</span> <span style="color: #ff0000; font-weight: bold;">un</span> <span style="color: #ff0000; font-weight: bold;">nuevo</span> <span style="color: #ff0000; font-weight: bold;">objeto</span> <span style="color: #ff0000; font-weight: bold;">InsertQuery</span> <span style="color: #ff0000; font-weight: bold;">para</span> <span style="color: #ff0000; font-weight: bold;">la</span> <span style="color: #ff0000; font-weight: bold;">base</span> <span style="color: #ff0000; font-weight: bold;">de</span> <span style="color: #ff0000; font-weight: bold;">datos</span> <span style="color: #ff0000; font-weight: bold;">activa</span>.
<span style="color: #ff0000; font-weight: bold;">Parametros</span>
$<span style="color: #a0522d;">table</span> <span style="color: #ff0000; font-weight: bold;">La</span> <span style="color: #ff0000; font-weight: bold;">tabla</span> <span style="color: #ff0000; font-weight: bold;">en</span> <span style="color: #ff0000; font-weight: bold;">la</span> <span style="color: #ff0000; font-weight: bold;">que</span> <span style="color: #ff0000; font-weight: bold;">se</span> <span style="color: #ff0000; font-weight: bold;">hace</span> <span style="color: #ff0000; font-weight: bold;">la</span> <span style="color: #ff0000; font-weight: bold;">inserci&#243;n</span>
$<span style="color: #a0522d;">options</span> <span style="color: #ff0000; font-weight: bold;">Un</span> <span style="color: #ff0000; font-weight: bold;">array</span> <span style="color: #ff0000; font-weight: bold;">de</span> <span style="color: #ff0000; font-weight: bold;">opciones</span> <span style="color: #ff0000; font-weight: bold;">para</span> <span style="color: #ff0000; font-weight: bold;">controlar</span> <span style="color: #ff0000; font-weight: bold;">c&#243;mo</span> <span style="color: #ff0000; font-weight: bold;">opera</span> <span style="color: #ff0000; font-weight: bold;">la</span> <span style="color: #ff0000; font-weight: bold;">consulta</span>.
<span style="color: #ff0000; font-weight: bold;">Valor</span> <span style="color: #ff0000; font-weight: bold;">devuelto</span>
<span style="color: #ff0000; font-weight: bold;">InsertQuery</span> <span style="color: #ff0000; font-weight: bold;">Un</span> <span style="color: #ff0000; font-weight: bold;">nuevo</span> <span style="color: #ff0000; font-weight: bold;">objeto</span> <span style="color: #ff0000; font-weight: bold;">InsertQuery</span> <span style="color: #ff0000; font-weight: bold;">para</span> <span style="color: #ff0000; font-weight: bold;">esta</span> <span style="color: #ff0000; font-weight: bold;">conexi&#243;n</span>.
</pre>
</div>

<p>
Es posible consultar la api de <a href="http://api.drupal.org/api/drupal/includes--database--database.inc/function/db_insert/7">db<sub>insert</sub></a>, para una descripción
actualizada de la función y sus argumentos.
</p>
</div>
</div>
<div id="outline-container-sec-1-15" class="outline-3">
<h3 id="sec-1-15">db\<sub>update</sub></h3>
<div class="outline-text-3" id="text-1-15">
<p>
Actualiza registros de la base de datos. Ahora un ejemplo:
</p>

<div class="org-src-container">

<pre class="src src-php"><span style="color: #483d8b;">&lt;?php</span>
$<span style="color: #a0522d;">num_updated</span> = <span style="color: #000000; background-color: #ffffff;">db_update(</span><span style="color: #8b2252;">'node'</span>) <span style="color: #b22222;">// </span><span style="color: #b22222;">Table name no longer needs {}</span>
-<span style="color: #008b8b;">&gt;</span><span style="color: #000000; background-color: #ffffff;">fields</span>(<span style="color: #000000; background-color: #ffffff;">array(</span>
 <span style="color: #8b2252;">'uid'</span>=&gt;<span style="color: #000000; background-color: #ffffff;">5</span>,
 <span style="color: #8b2252;">'status'</span>=&gt;<span style="color: #000000; background-color: #ffffff;">1</span>,
))
-&gt;<span style="color: #000000; background-color: #ffffff;">condition</span>(<span style="color: #8b2252;">'created'</span>,<span style="color: #ff0000; font-weight: bold;">REQUEST_TIME</span>-<span style="color: #000000; background-color: #ffffff;">3600</span>,<span style="color: #8b2252;">'&gt;='</span>)
-&gt;<span style="color: #000000; background-color: #ffffff;">execute</span>();
<span style="color: #483d8b;">?&gt;</span>
</pre>
</div>

<p>
Este ejemplo ejecuta la siguiente consulta SQL: 
</p>

<div class="org-src-container">

<pre class="src src-sql">UPDATE {node} SET uid=5, status=1 WHERE created &gt;= 1221717405"
</pre>
</div>

<p>
La llamada a la API de db<sub>update</sub> es la siguiente:
</p>

<div class="org-src-container">

<pre class="src src-php"><span style="color: #000000; background-color: #ffffff;">db_update(</span>$<span style="color: #a0522d;">table</span>, <span style="color: #228b22;">array</span> $<span style="color: #a0522d;">options</span> = <span style="color: #000000; background-color: #ffffff;">array(</span>)) 
<span style="color: #ff0000; font-weight: bold;">Devuelve</span> <span style="color: #ff0000; font-weight: bold;">un</span> <span style="color: #ff0000; font-weight: bold;">nuevo</span> <span style="color: #ff0000; font-weight: bold;">objeto</span> <span style="color: #ff0000; font-weight: bold;">UpdateQuery</span> <span style="color: #ff0000; font-weight: bold;">para</span> <span style="color: #ff0000; font-weight: bold;">la</span> <span style="color: #ff0000; font-weight: bold;">base</span> <span style="color: #ff0000; font-weight: bold;">de</span> <span style="color: #ff0000; font-weight: bold;">datos</span> <span style="color: #ff0000; font-weight: bold;">activa</span>.
<span style="color: #ff0000; font-weight: bold;">Par&#225;metros</span>
$<span style="color: #a0522d;">table</span> <span style="color: #ff0000; font-weight: bold;">La</span> <span style="color: #ff0000; font-weight: bold;">tabla</span> <span style="color: #ff0000; font-weight: bold;">a</span> <span style="color: #ff0000; font-weight: bold;">actualizar</span>.
$<span style="color: #a0522d;">options</span> <span style="color: #ff0000; font-weight: bold;">Un</span> <span style="color: #ff0000; font-weight: bold;">array</span> <span style="color: #ff0000; font-weight: bold;">de</span> <span style="color: #ff0000; font-weight: bold;">opciones</span> <span style="color: #ff0000; font-weight: bold;">para</span> <span style="color: #ff0000; font-weight: bold;">controlar</span> <span style="color: #ff0000; font-weight: bold;">c&#243;mo</span> <span style="color: #ff0000; font-weight: bold;">opera</span> <span style="color: #ff0000; font-weight: bold;">la</span> <span style="color: #ff0000; font-weight: bold;">consulta</span>.
<span style="color: #ff0000; font-weight: bold;">Valor</span> <span style="color: #ff0000; font-weight: bold;">devuelto</span>
<span style="color: #ff0000; font-weight: bold;">UpdateQuery</span> <span style="color: #ff0000; font-weight: bold;">Un</span> <span style="color: #ff0000; font-weight: bold;">nuevo</span> <span style="color: #ff0000; font-weight: bold;">objeto</span> <span style="color: #ff0000; font-weight: bold;">UpdateQuery</span> <span style="color: #ff0000; font-weight: bold;">para</span> <span style="color: #ff0000; font-weight: bold;">esta</span> <span style="color: #ff0000; font-weight: bold;">conexi&#243;n</span>.
</pre>
</div>

<p>
Es posible consultar la <a href="http://api.drupal.org/api/drupal/includes--database--database.inc/function/db_update/7">api de db<sub>update</sub></a>, para una descripción
actualizada de la función y sus argumentos.
</p>
</div>
</div>
<div id="outline-container-sec-1-16" class="outline-3">
<h3 id="sec-1-16">db<sub>delete</sub></h3>
<div class="outline-text-3" id="text-1-16">
<p>
Elimina registros de la base de datos. Ahora un ejemplo:
</p>

<div class="org-src-container">

<pre class="src src-php"><span style="color: #483d8b;">&lt;?php</span>
$<span style="color: #a0522d;">nid</span>=<span style="color: #000000; background-color: #ffffff;">5</span>;                             
$<span style="color: #a0522d;">num_deleted</span>=<span style="color: #000000; background-color: #ffffff;">db_delete(</span><span style="color: #8b2252;">'node'</span>)-<span style="color: #008b8b;">&gt;</span><span style="color: #000000; background-color: #ffffff;">condition</span>(<span style="color: #8b2252;">'nid'</span>,$<span style="color: #a0522d;">nid</span>)-&gt;<span style="color: #000000; background-color: #ffffff;">execute</span>();
<span style="color: #483d8b;">?&gt;</span>
</pre>
</div>

<p>
Este ejemplo es equivalente a la consulta SQL "DELETE FROM {node}
WHERE nid = 5".
</p>

<p>
La llamada a la API de db<sub>delete</sub> es la siguiente:
</p>

<div class="org-src-container">

<pre class="src src-php"><span style="color: #000000; background-color: #ffffff;">db_delete(</span>$<span style="color: #a0522d;">table</span>, <span style="color: #228b22;">array</span> $<span style="color: #a0522d;">options</span> = <span style="color: #000000; background-color: #ffffff;">array(</span>)) 
<span style="color: #ff0000; font-weight: bold;">Devuelve</span> <span style="color: #ff0000; font-weight: bold;">un</span> <span style="color: #ff0000; font-weight: bold;">nuevo</span> <span style="color: #ff0000; font-weight: bold;">objeto</span> <span style="color: #ff0000; font-weight: bold;">DeleteQuery</span> <span style="color: #ff0000; font-weight: bold;">para</span> <span style="color: #ff0000; font-weight: bold;">la</span> <span style="color: #ff0000; font-weight: bold;">base</span> <span style="color: #ff0000; font-weight: bold;">de</span> <span style="color: #ff0000; font-weight: bold;">datos</span> <span style="color: #ff0000; font-weight: bold;">activa</span>.
<span style="color: #ff0000; font-weight: bold;">Par&#225;metros</span>
$<span style="color: #a0522d;">table</span> <span style="color: #ff0000; font-weight: bold;">La</span> <span style="color: #ff0000; font-weight: bold;">tabla</span> <span style="color: #ff0000; font-weight: bold;">d&#243;nde</span> <span style="color: #ff0000; font-weight: bold;">se</span> <span style="color: #ff0000; font-weight: bold;">suprimen</span> <span style="color: #ff0000; font-weight: bold;">las</span> <span style="color: #ff0000; font-weight: bold;">filas</span>
$<span style="color: #a0522d;">options</span> <span style="color: #ff0000; font-weight: bold;">Un</span> <span style="color: #ff0000; font-weight: bold;">array</span> <span style="color: #ff0000; font-weight: bold;">de</span> <span style="color: #ff0000; font-weight: bold;">opciones</span> <span style="color: #ff0000; font-weight: bold;">para</span> <span style="color: #ff0000; font-weight: bold;">controlar</span> <span style="color: #ff0000; font-weight: bold;">c&#243;mo</span> <span style="color: #ff0000; font-weight: bold;">la</span> <span style="color: #ff0000; font-weight: bold;">consulta</span> <span style="color: #ff0000; font-weight: bold;">opera</span>.
<span style="color: #ff0000; font-weight: bold;">Valor</span> <span style="color: #ff0000; font-weight: bold;">devuelto</span>
<span style="color: #ff0000; font-weight: bold;">DeleteQuery</span> <span style="color: #ff0000; font-weight: bold;">Un</span> <span style="color: #ff0000; font-weight: bold;">nuevo</span> <span style="color: #ff0000; font-weight: bold;">objeto</span> <span style="color: #ff0000; font-weight: bold;">DeleteQuery</span> <span style="color: #ff0000; font-weight: bold;">para</span> <span style="color: #ff0000; font-weight: bold;">esta</span> <span style="color: #ff0000; font-weight: bold;">conexi&#243;n</span>.
</pre>
</div>

<p>
Es posible consultar la <a href="http://api.drupal.org/api/drupal/includes--database--database.inc/function/db_delete/7">api de db<sub>delete</sub></a>, para una descripción
actualizada de la función y sus argumentos.
</p>
</div>
</div>
<div id="outline-container-sec-1-17" class="outline-3">
<h3 id="sec-1-17">db\<sub>transaction</sub></h3>
<div class="outline-text-3" id="text-1-17">
<p>
Devuelve una nueva transacción para la base de datos activa.
</p>

<div class="org-src-container">

<pre class="src src-php">$<span style="color: #a0522d;">transaction</span> = <span style="color: #000000; background-color: #ffffff;">db_transaction(</span>);

<span style="color: #a020f0;">try</span> {
  <span style="color: #b22222;">// </span><span style="color: #b22222;">Query 1</span>
  <span style="color: #000000; background-color: #ffffff;">db_update(</span>...);

  <span style="color: #b22222;">// </span><span style="color: #b22222;">Query 2</span>
  <span style="color: #000000; background-color: #ffffff;">db_update(</span>...);
}
<span style="color: #a020f0;">catch</span> (<span style="color: #228b22;">Exception</span> $<span style="color: #a0522d;">e</span>) {
  <span style="color: #b22222;">// </span><span style="color: #b22222;">Rollback the transaction</span>
  $<span style="color: #a0522d;">transaction</span>-&gt;<span style="color: #000000; background-color: #ffffff;">rollback</span>();

  <span style="color: #b22222;">// </span><span style="color: #b22222;">Do something with the exception (inform user, etc)</span>
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Desarrollo de Módulos</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">Arquitectura de los Módulos de Drupal</h3>
<div class="outline-text-3" id="text-2-1">
<p>
¿Qué es exactamente un módulo y cuál es su propósito?
</p>

<p>
La segunda pregunta es fácil de responder: un módulo Drupal es un
mecanismo diseñado para proporcionar un método uniforme de extender
las funcionalidades de Drupal. Esta respuesta nos acerca bastante a
responder a la primera cuestión. Un módulo es un conjunto de código
PHP y ficheros que usan la API de Drupal y la arquitectura para
integrar nuevos componentes funcionales dentro del framework
Drupal. Un propósito de este manual es explicar cómo escribir este
código.
</p>

<p>
Empecemos ahora a echar un vistazo a la arquitectura del módulo. Los
ficheros que crean los módulos están agrupado dentro de localizaciones
específicicas bajo la estructura de directorios de Drupal. Esto es, en
el sistema de fichero de la instalación de Drupal, los módulos Drupal
deben residir en unos pocos lugares. 
</p>

<p>
Cuando Drupal necesita información acerca de sus módulos, mirará en
estos lugares predeterminados. Cada módulo está contenido en su propio
directorio, y tiene al menos 2 ficheros—uno describiendo el contenido
del módulo y uno ó más ficheros conteniendo código y otro material de
soporte.  
</p>

<p>
Antes de que un módulo pueda ser usado, debe ser activado por un
administrador de Drupal. Sin embargo, una vez un módulo es activado,
entonces es cargado cuando se le requiere y Drupal pasa las
solicitudes al módulo.
</p>
</div>
</div>
<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2">Módulos del Núcleo</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Algunos módulos son tan importantes que eliminándolos desactivarías
funcionalidades esenciales para el funcionamiento de Drupal. También,
hay módulos que proporcionan funcionalidades necesarias por una amplia
variedad de sistemas. Estos dos grupos de módulos, son mantenidos por
el equipo de desarrolladores de Drupal, y son colectivamente referidos
como los Módulos del Núcleo de Drupal. Estos módulos están incluidos
por defecto en la instalación de Drupal, y tienen un activo
mantenimiento y desarrollo por la comunidad Drupal.
</p>

<p>
A pesar de este importante rol, hay pocas distinciones entre los
Módulos del Núcleo de Drupal y cualquier otro módulo. Ellos siguen las
mismas directrices y usan la misma API. No hay nada particularmente
arcano en estos módulos.
</p>

<p>
Desde la sección de administración de Drupal, es posible ver la lista
de los módulos del núcleo en Administración -&gt; Módulos.
</p>


<div class="figure">
<p><img src="file:///home/davidam/public_html/docu/drupal/pantallazo5.png" alt="pantallazo5.png" />
</p>
</div>

<p>
Una de las maravillas de la arquitectura de Drupal es la facilidad con
que varios módulos interactúan. Usando la arquitectura de hook, los
servicios que los módulos proporcionan pueden ser tejidos juntos para
crear robustas funcionalidades sin copiosas cantidades de código.
</p>

<p>
Los módulos del core proporcionan una excelente referencia para saber
cómo el código de Drupal debe ser escrito.
</p>
</div>
</div>
<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3">Hooks</h3>
<div class="outline-text-3" id="text-2-3">
<p>
¿Cómo Drupal sabe cuando invocar a un módulo para manejar una
solicitud particular?. Esto es hecho a través del mecanismo de hooks,
que nosotros examinaremos cuidadosamente en este manual. Para empezar,
una breve explicación de cómo funcionan los hooks. Cuando Drupal
gestiona una solicitud desde un usuario, procede a través de una serie
de pasos. Por ejemplo, el núcleo de Drupal primero inicia la
aplicación, definiendo variables críticas y funciones frecuentemente
usadas. Lo siguiente es, cargar librerías críticas, temas y
módulos. Lo siguiente es, continuar procesando la solicitud, mapeando
la URI solicitada al código que la maneja y así. Después, aplica un
tema a los datos, formateando información como salida. Finalmente,
devuelve la salida al navegador del usuario.
</p>

<p>
En este paso a paso, hay momentos predefinidos en los que Drupal
ejecuta hooks. ¿Qué significa esto?. En resumen, significa que Drupal
examina algunos ó todos los módulos actualmente activados que siguen
específicos y predefinidos patrones. Algunos tienen enlazado a este
proceso un método "callback".
</p>

<p>
Por ejemplo, mientras se está creando el contenido para una página
vista, Drupal podría escanear módulos para funciones llamadas
&lt;modulename&gt;\<sub>block</sub>() y &lt;modulename&gt;\<sub>view</sub>() (donde &lt;modulename&gt; es
reemplazado por el nombre de cada módulo que chequea).
</p>

<p>
Los módulos que contienen tales funciones son aquellos que implementan
hook<sub>block</sub>() y hook<sub>view</sub>().
</p>

<p>
Cuando Drupal encuentra tales funciones, las ejecuta, y usa los datos
de estas funciones para devolver una respuesta que enviar al
usuario. Drupal continúa su procesamiento de la solicitud paso por
paso, quizás ejecutando muchos otros hooks. Una vez que todos los
pasos han sido completados y una respuesta ha sido enviada al usuario,
Drupal se limpia a sí mismo y termina la ejecución.
</p>

<p>
Los módulos pueden definir sus propios hooks, que otros módulos pueden
usar. De este modo, el mecanismo de hook puede ser extendido para
proporcionar un personalizado comportamiento complejo.
</p>

<p>
Cuando un módulo proporciona una función que empareja una firma hook,
nosotros decimos que este módulo implementa este hook. Por ejemplo,
imagina que Drupal tiene hook llamado hook\<sub>example</sub>. Si nosotros
definiéramos un módulo llamado mimodulo que contuviera una función
llamada mimodulo\<sub>example</sub>(), estaríamos implementando hook\<sub>example</sub>().
</p>
</div>
</div>
<div id="outline-container-sec-2-4" class="outline-3">
<h3 id="sec-2-4">Creación de Bloques</h3>
<div class="outline-text-3" id="text-2-4">
<p>
Esta sección tiene un doble objetivo: introducir a la api de bloques y
crear un primer módulo. Y en el siguiente capítulo se verá cómo
instalar dicho módulo.
</p>

<p>
En Drupal, cada módulo está contenido en su propio directorio. Esto
simplifica la organización; todos los ficheros de un módulo están
localizados en un lugar. Así que vamos a crear un directorio que sea
descriptivo del bloque que vamos a crear en nuestro caso mibloque.
</p>

<div class="org-src-container">

<pre class="src src-bash">cd sites/all/modules
mkdir mibloque
</pre>
</div>

<p>
Una vez se ha creado el directorio, es posible empezar a crear
ficheros para el módulo. El primer fichero a crear será el fichero
.info.
</p>
</div>
</div>
<div id="outline-container-sec-2-5" class="outline-3">
<h3 id="sec-2-5">Creando un fichero .info</h3>
<div class="outline-text-3" id="text-2-5">
<p>
El fichero .info es escrito como un fichero PHP INI, que es un formato
para configuraciones simples.
</p>

<p>
El fichero .info debe seguir las convenciones de nombres estándar para
módulos. Debe ser nombrado &lt;modulename&gt;.info, donde &lt;modulename&gt; es el
mismo que el nombre del directorio. Nuestro fichero, por tanto, será
llamado mibloque.info.
</p>

<p>
Lo siguiente son los contenidos de mibloque.info:
</p>

<div class="org-src-container">

<pre class="src src-php">;$<span style="color: #a0522d;">Id$</span> 
<span style="color: #ff0000; font-weight: bold;">name</span> = <span style="color: #8b2252;">"Mi Bloque"</span> 
<span style="color: #ff0000; font-weight: bold;">description</span> = <span style="color: #8b2252;">"Muestra un bloque creado desde la API"</span> 
<span style="color: #ff0000; font-weight: bold;">core</span> = <span style="color: #000000; background-color: #ffffff;">7</span>.<span style="color: #ff0000; font-weight: bold;">x</span>
</pre>
</div>

<p>
Este fichero no es particularmente grande. La primera línea del
fichero es, a primera vista, la más críptica. Sin emabargo, su función
es mundana: es la variable para servidor CVS o Subversion de Drupal.
</p>

<p>
Las siguientes 3 directivas proporcionan información del módulo a
Drupal.
</p>

<p>
La directiva name proporciona un nombre "legible por humanos" para el
módulo. Anteriormente, ya se ha visto brevemente cómo se activa un
módulo. Los nombres de los módulos que se vieron se extrajeron de la
directiva name de los ficheros .info. Aquí hay un ejemplo:
</p>


<div class="figure">
<p><img src="file:///home/davidam/public_html/docu/drupal/pantallazo8.png" alt="pantallazo8.png" />  
</p>
</div>

<p>
En el pantallazo los nombres "Aggregator" y "Block" son tomado de las
directivas name de sus respectivos fichero .info.
</p>

<p>
Otra directiva que también aparece en el pantallazo es description
("Descripción").
</p>

<p>
La tercera directiva es core. Esta directiva especifica que versión de
Drupal es requerida para que el módulo funcione de manera
apropiada. El valor 7.x indica que el módulo funcionará en Drupal
(incluidas sus revisiones). En muchos casos, el empaquetador de Drupal
será capaz de establecer esto correctamente de manera automática. Pero
los desarrolladores de Drupal sugieren que esta directiva sea asignada
manualmente para quienes trabajan desde CVS.
</p>
</div>
</div>
<div id="outline-container-sec-2-6" class="outline-3">
<h3 id="sec-2-6">Un fichero .module</h3>
<div class="outline-text-3" id="text-2-6">
<p>
Como mencionamos en el primer capítulo, hay dos ficheros que cualquier
módulo debe tener (aunque muchos módulos tienen más). El primero, es
el fichero .info, del que ya se ha hablado. El segundo fichero es el
fichero .module, que es un fichero script en PHP. Este fichero
implementa un puñado de funciones hook que Drupal llamará en
predeterminadas veces durante una solicitud.
</p>

<p>
Aquí, se creará un fichero .module que mostrará uns pequeña y
formateada sección de información. Después en este capítulo, se
configurará Drupal para mostrar esto a los visitantes del sitio.
</p>
</div>
</div>
<div id="outline-container-sec-2-7" class="outline-3">
<h3 id="sec-2-7">Nuestro objetivo: Dos Block Hook</h3>
<div class="outline-text-3" id="text-2-7">
<p>
Para este muy primer módulo, se implementará las funciones
hook\<sub>block\</sub><sub>info</sub>() y hook\<sub>block\</sub><sub>view</sub>(). En dialecto Drupal, un bloque
es un trozo de información auxiliar que es mostrada en una página a lo
largo de la página principal de contenido. ¿Suena confuso? Un ejemplo
podría ayudar. Piensa en tu sitio web favorito de noticias. En una
típica página de artículo, el texto del artículo es mostrado en la
mitad de la página. Pero en los laterales y quizás arriba y abajo, hay
otros trozos de información: un menú del sitio, una lista de enlaces a
artículos relacionados, enlaces a comentarios ó foros acerca del
artículo, etc. En Drupal, estas piezas extra son tratadas como
bloques.
</p>
</div>
</div>
<div id="outline-container-sec-2-8" class="outline-3">
<h3 id="sec-2-8">Empezando el .module</h3>
<div class="outline-text-3" id="text-2-8">
<p>
Como ya se mencionó, Drupal sigue una codificación rigurosa y
estándares de documentación (<a href="http://drupal.org/coding-standards">http://drupal.org/coding-standards</a>). En
este manual, se hará todo lo posible por seguir estos estándares. Así
que al empezar el módulo, la primera cosa que se hace es proporcionar
alguna documentación para el API.
</p>

<p>
Empecemos con nuestro fichero  mibloque.module.
</p>

<div class="org-src-container">

<pre class="src src-php"><span style="color: #483d8b;">&lt;?php</span> 
<span style="color: #b22222;">// </span><span style="color: #b22222;">$Id$ </span>
<span style="color: #b22222;">/** </span>
<span style="color: #b22222;"> @file </span>
<span style="color: #b22222;"> Module for show data in a block</span>
<span style="color: #b22222;"> This module provides block content builded from the api</span>
<span style="color: #b22222;">*/</span>
</pre>
</div>

<p>
Después del PHP tag "&lt;?php" encontramos la palabra clave para el
control de versiones: 
</p>

<p>
// \(Id\) 
</p>

<p>
Cuando el módulo sea chequeado dentro del Drupal CVS, la información
acerca de la actual revisión es fijada ahí.  
</p>

<p>
La tercera parte de este ejemplo es la documentación del API. Esta
documentación es contenido en un bloque de comentario especial, que
comienza con <i>** y finaliza con *</i>. Cualquier cosa entre esto es
tratada como documentación. Programas de extracción como Doxygen
pueden extraer esta información y crear información de programación
útil para el usuario final.
</p>
</div>
</div>
<div id="outline-container-sec-2-9" class="outline-3">
<h3 id="sec-2-9">La implementación de hook\<sub>block\</sub><sub>info</sub>()</h3>
<div class="outline-text-3" id="text-2-9">
<p>
El módulo muestra información dentro de un bloque Drupal. Para hacer
esto, nosotros necesitamos implementar las funciones hook<sub>block</sub><sub>info</sub>()
y hook\<sub>block\</sub><sub>view</sub>(). La primera nos da la información de configuración
de bloque y la segunda define lo que va a ser visto en el bloque.
</p>

<p>
Todos los métodos hook siguen la convención de nombre: &lt;module
name&gt;\_&lt;hook name&gt;. Así nuestro hook de bloque se llamará
mibloque\<sub>block\</sub><sub>info</sub>().
</p>

<div class="org-src-container">

<pre class="src src-php"><span style="color: #a020f0;">function</span> <span style="color: #0000ff;">mibloque_block_info</span>() { 
  $<span style="color: #a0522d;">blocks</span> = <span style="color: #000000; background-color: #ffffff;">array(</span>); 

  $<span style="color: #a0522d;">blocks</span>[<span style="color: #8b2252;">'info'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span> 
    <span style="color: #8b2252;">'info'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'My block'</span>) 
  ); 

  <span style="color: #a020f0;">return</span> $<span style="color: #a0522d;">blocks</span>; 
}
</pre>
</div>

<p>
En este ejemplo solo vamos a darle un valor a la cadena con la que
identificaremos nuestro bloque en la administración de bloques.
</p>
</div>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">La implementación de hook\<sub>block\</sub><sub>view</sub>()</h2>
<div class="outline-text-2" id="text-3">
<p>
Ahora veamos como establecer un título y un cuerpo para nuestro bloque:
</p>

<div class="org-src-container">

<pre class="src src-php"><span style="color: #a020f0;">function</span> <span style="color: #0000ff;">mibloque_block_view</span>($<span style="color: #a0522d;">delta</span> = <span style="color: #8b2252;">''</span>){ 
  $<span style="color: #a0522d;">block</span> = <span style="color: #000000; background-color: #ffffff;">array(</span>); 
 $<span style="color: #a0522d;">block</span>[<span style="color: #8b2252;">'subject'</span>] = <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'T&#237;tulo de Mi Bloque'</span>); 
  $<span style="color: #a0522d;">block</span>[<span style="color: #8b2252;">'content'</span>] = <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'Cuerpo de Mi Bloque'</span>); 
 <span style="color: #a020f0;">return</span> $<span style="color: #a0522d;">block</span>; 
}
</pre>
</div>

<p>
Como se ve es bastante similar que en el hook anterior se establece un
array al que le vamos metiendo los valores a introducir.
</p>
</div>

<div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1">Instalación de Módulos</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Para poder visualizar el resultado del módulo escrito es necesario
aprender a instalar módulos. En Drupal 7 es posible instalar módulos
desde el "Update Manager" (navegar a Administración -&gt; Módulos y allí
hacer click a "Instalar nuevo módulo"). De este modo, introducimos la
url del módulo a instalar y todo se hace automáticamente. En nuestro
caso, tenemos el módulo en local, así es que debemos instalar nuestro
módulo al viejo estilo.
</p>

<p>
El directorio de nuestro módulo debe estar en el directorio
drupal/sites/all/modules, fijaos que también existe drupal/modules
pero en ese directorio solo deben estar los módulos del núcleo de
Drupal. En caso de que no esté lo copiamos:
</p>

<div class="org-src-container">

<pre class="src src-bash">cp -r mibloque /var/www/drupal/sites/all/modules
</pre>
</div>

<p>
Ahora ya podemos ir a Administración -&gt; Módulos y buscar nuestro
módulo. Lo activamos y pulsamos guardar configuración.
</p>

<p>
Lo siguiente es activar el bloque desde Administración -&gt; Estructura
-&gt; Bloques y ya se puede ver el resultado:
</p>


<div class="figure">
<p><img src="file:///home/davidam/public_html/docu/drupal/pantallazo10.png" alt="pantallazo10.png" />
</p>
</div>
</div>
</div>
<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2">Form API</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Ahora un tutorial paso a paso para aprender la api de
formularios. Este tutorial es una traducción y adaptación de
<a href="http://drupal.org/node/262422">http://drupal.org/node/262422</a>.
</p>

<p>
Lo primero es crear un módulo dónde vamos a ir introduciendo el código
para ejecutar la api form. Seguid el paso a paso para aprender a
visualizar los ejemplos:
</p>

<ol class="org-ol">
<li>Crear un nuevo directorio en sites/all/modules y llamarlo 'form\<sub>tutorial'</sub>.
</li>
<li>Crear un fichero llamado form\<sub>tutorial</sub>.info en el directorio
form\<sub>tutorial</sub> con los siguientes contenidos:
</li>
</ol>
<div class="org-src-container">

<pre class="src src-php"><span style="color: #ff0000; font-weight: bold;">name</span> = <span style="color: #ff0000; font-weight: bold;">Form</span> <span style="color: #ff0000; font-weight: bold;">tutorial</span>
<span style="color: #ff0000; font-weight: bold;">description</span> = <span style="color: #ff0000; font-weight: bold;">Module</span> <span style="color: #a020f0;">for</span> <span style="color: #ff0000; font-weight: bold;">form</span> <span style="color: #ff0000; font-weight: bold;">api</span> <span style="color: #ff0000; font-weight: bold;">tutorial</span>
<span style="color: #ff0000; font-weight: bold;">core</span> = <span style="color: #000000; background-color: #ffffff;">7</span>.<span style="color: #ff0000; font-weight: bold;">x</span>
</pre>
</div>
<ol class="org-ol">
<li>Crear un fichero y llamarlo form\<sub>tutorial</sub>.module. Cortar y pegar
el primer ejemplo de código dentro de form\<sub>tutorial</sub>.module (indicar
que es preferible omitir el tag de cierre ?&gt;).
</li>
<li>Activar "Form tutorial" en admin/modules.
</li>
<li>Escribir lo siguiente en la barra de direcciones del navegador:
<a href="http://yoursite_site_url/?q=form_tutorial/form">http://yoursite_site_url/?q=form_tutorial/form</a> ó
<a href="http://yoursite_site_url/form_tutorial/form">http://yoursite_site_url/form_tutorial/form</a> dependiendo de su
configuración.
</li>
<li>Para cada ejemplo de código en el tutorial, reemplazar el código
de la función form\<sub>tutorial\</sub><sub>my\</sub><sub>form</sub> en form\<sub>tutorial</sub>.module con el
nuevo trozo de código y escribir lo siguiente en la barra de
direcciones del navegador:
<a href="http://yoursite_site_url/?q=form_tutorial/form">http://yoursite_site_url/?q=form_tutorial/form</a> ó
<a href="http://yoursite_site_url/form_tutorial/form">http://yoursite_site_url/form_tutorial/form</a> dependiendo de su
configuración.
</li>
</ol>
</div>
</div>
<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3">Formulario Básico</h3>
<div class="outline-text-3" id="text-3-3">
<p>
Este es un formulario muy básico que será extendido en los siguientes
ejemplos.
</p>

<div class="org-src-container">

<pre class="src src-php"><span style="color: #483d8b;">&lt;?php</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">This function defines the URL to the page created etc.</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">See http://api.drupal.org/api/function/hook_menu/6</span>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">form_tutorial_menu</span>() {
 $<span style="color: #a0522d;">items</span> = <span style="color: #000000; background-color: #ffffff;">array(</span>);
 $<span style="color: #a0522d;">items</span>[<span style="color: #8b2252;">'form_tutorial/form'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
 <span style="color: #8b2252;">'title'</span> =<span style="color: #008b8b;">&gt;</span> <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'My form'</span>),
 <span style="color: #8b2252;">'page callback'</span> =&gt; <span style="color: #8b2252;">'form_tutorial_form'</span>,
 <span style="color: #8b2252;">'access arguments'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">array(</span><span style="color: #8b2252;">'access content'</span>),
 <span style="color: #8b2252;">'description'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'My form'</span>),
 <span style="color: #8b2252;">'type'</span> =&gt; <span style="color: #ff0000; font-weight: bold;">MENU_CALLBACK</span>,
 );
 <span style="color: #a020f0;">return</span> $<span style="color: #a0522d;">items</span>;
}

<span style="color: #b22222;">// </span><span style="color: #b22222;">This function gets called in the browser address bar for: </span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">"http://yourhost/form_tutorial/form" or </span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">"http://yourhost/?q=form_tutorial/form". It will generate// a page with //this form on it.</span>

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">form_tutorial_form</span>() {

 <span style="color: #b22222;">// </span><span style="color: #b22222;">This form calls the form builder function via the</span>
 <span style="color: #b22222;">// </span><span style="color: #b22222;">drupal_get_form() function which takes the name of this form builder</span>
 <span style="color: #b22222;">// </span><span style="color: #b22222;">function as an argument. It returns the results to display the form. </span>
<span style="color: #a020f0;">return</span> <span style="color: #000000; background-color: #ffffff;">drupal_get_form(</span><span style="color: #8b2252;">'form_tutorial_my_form'</span>);

}

<span style="color: #b22222;">// </span><span style="color: #b22222;">This function is called the "form builder". It builds the form.</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">Notice, it takes one argument, the $form_state</span>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">form_tutorial_my_form</span>($<span style="color: #a0522d;">form_state</span>) {

 <span style="color: #b22222;">// </span><span style="color: #b22222;">This is the first form element. It's a textfield with a label, "Name"</span>
 $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'name'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
 <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'textfield'</span>,
 <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'Name'</span>),
 );
 <span style="color: #a020f0;">return</span> $<span style="color: #a0522d;">form</span>;
}
<span style="color: #483d8b;">?&gt;</span>
</pre>
</div>

<p>
La primera función implementa hook<sub>menu</sub> y dicho de manera muy somera
nos da el acceso url desde el que visualizaremos la página que
implementa el formulario.
</p>

<p>
form<sub>tutorial</sub><sub>menu</sub> tiene un callback a nuestra segunda función
form<sub>tutorial</sub><sub>form</sub>, por lo que el contenido de la página que hemos
creado será lo que devuelva form<sub>tutorial</sub><sub>form</sub>. Esto es el resultado
de drupal<sub>get</sub><sub>form</sub> habiendo pasado como argumento el array definido en
form<sub>tutorial</sub><sub>my</sub><sub>form</sub> que simplemente tiene el título 'Name'.
</p>
</div>
</div>
<div id="outline-container-sec-3-4" class="outline-3">
<h3 id="sec-3-4">Formulario Básico con Botón Submit</h3>
<div class="outline-text-3" id="text-3-4">
<p>
Ahora se añade un botón submit al formulario anterior.
</p>

<div class="org-src-container">

<pre class="src src-php"><span style="color: #483d8b;">&lt;?php</span>

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">form_tutorial_my_form</span>($<span style="color: #a0522d;">form_state</span>) {
 $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'description'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
 <span style="color: #8b2252;">'#type'</span> =<span style="color: #008b8b;">&gt;</span> <span style="color: #8b2252;">'item'</span>,
 <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'A simple form with a submit button'</span>),
 );

 $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'name'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
 <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'textfield'</span>,
 <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'Name'</span>),
 );
 $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'submit'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
 <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'submit'</span>,
 <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'Submit'</span>),
 );
 <span style="color: #a020f0;">return</span> $<span style="color: #a0522d;">form</span>;
}
<span style="color: #483d8b;">?&gt;</span>
</pre>
</div>

<p>
En este ejemplo tan solo hemos añadido una descripción y el botón
submit.
</p>
</div>
</div>
<div id="outline-container-sec-3-5" class="outline-3">
<h3 id="sec-3-5">Un formulario básico con fieldset</h3>
<div class="outline-text-3" id="text-3-5">
<p>
Ahora se verá cómo añadir fieldset (conjunto de campos).
</p>

<div class="org-src-container">

<pre class="src src-php"><span style="color: #483d8b;">&lt;?php</span>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">form_example_tutorial_3</span>($<span style="color: #a0522d;">form</span>, &amp;$<span style="color: #a0522d;">form_state</span>) {
  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'description'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =<span style="color: #008b8b;">&gt;</span> <span style="color: #8b2252;">'item'</span>, 
    <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'A form with a fieldset'</span>),
  );

  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'name'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'fieldset'</span>, 
    <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'Name'</span>),
  );
  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'name'</span>][<span style="color: #8b2252;">'first'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'textfield'</span>, 
    <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'First name'</span>),
  );
  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'name'</span>][<span style="color: #8b2252;">'last'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'textfield'</span>, 
    <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'Last name'</span>),
  );


  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'submit'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'submit'</span>, 
    <span style="color: #8b2252;">'#value'</span> =&gt; <span style="color: #8b2252;">'Submit'</span>,
  );
  <span style="color: #a020f0;">return</span> $<span style="color: #a0522d;">form</span>;
}
<span style="color: #483d8b;">?&gt;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-3-6" class="outline-3">
<h3 id="sec-3-6">Formulario Básico con Campos Obligatorios</h3>
<div class="outline-text-3" id="text-3-6">
<div class="org-src-container">

<pre class="src src-php"><span style="color: #483d8b;">&lt;?php</span>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">form_example_tutorial_4</span>($<span style="color: #a0522d;">form</span>, &amp;$<span style="color: #a0522d;">form_state</span>) {
  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'description'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =<span style="color: #008b8b;">&gt;</span> <span style="color: #8b2252;">'item'</span>, 
    <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'A form with validation'</span>),
  );

  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'name'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'fieldset'</span>, 
    <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'Name'</span>),
    <span style="color: #b22222;">// </span><span style="color: #b22222;">Make the fieldset collapsible. </span>
    <span style="color: #8b2252;">'#collapsible'</span> =&gt; <span style="color: #008b8b;">TRUE</span>, <span style="color: #b22222;">// </span><span style="color: #b22222;">Added </span>
    <span style="color: #8b2252;">'#collapsed'</span> =&gt; <span style="color: #008b8b;">FALSE</span>, <span style="color: #b22222;">// </span><span style="color: #b22222;">Added</span>
  );

  <span style="color: #b22222;">// </span><span style="color: #b22222;">Make these fields required.</span>
  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'name'</span>][<span style="color: #8b2252;">'first'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'textfield'</span>, 
    <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'First name'</span>), 
    <span style="color: #8b2252;">'#required'</span> =&gt; <span style="color: #008b8b;">TRUE</span>, <span style="color: #b22222;">// </span><span style="color: #b22222;">Added</span>
  );
  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'name'</span>][<span style="color: #8b2252;">'last'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'textfield'</span>, 
    <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'Last name'</span>), 
    <span style="color: #8b2252;">'#required'</span> =&gt; <span style="color: #008b8b;">TRUE</span>, <span style="color: #b22222;">// </span><span style="color: #b22222;">Added</span>
  );

  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'submit'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'submit'</span>, 
    <span style="color: #8b2252;">'#value'</span> =&gt; <span style="color: #8b2252;">'Submit'</span>,
  );
  <span style="color: #a020f0;">return</span> $<span style="color: #a0522d;">form</span>;
}
<span style="color: #483d8b;">?&gt;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-3-7" class="outline-3">
<h3 id="sec-3-7">Formulario Básico con Atributos de Elementos Adicionales</h3>
<div class="outline-text-3" id="text-3-7">
<div class="org-src-container">

<pre class="src src-php"><span style="color: #483d8b;">&lt;?php</span>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">form_example_tutorial_5</span>($<span style="color: #a0522d;">form</span>, &amp;$<span style="color: #a0522d;">form_state</span>) {
  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'description'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =<span style="color: #008b8b;">&gt;</span> <span style="color: #8b2252;">'item'</span>, 
    <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'A form with additional attributes'</span>), 
    <span style="color: #8b2252;">'#description'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'This one adds #default_value and #description'</span>),
  );
  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'name'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'fieldset'</span>, 
    <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'Name'</span>), 
    <span style="color: #8b2252;">'#collapsible'</span> =&gt; <span style="color: #008b8b;">TRUE</span>, 
    <span style="color: #8b2252;">'#collapsed'</span> =&gt; <span style="color: #008b8b;">FALSE</span>,
  );

  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'name'</span>][<span style="color: #8b2252;">'first'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'textfield'</span>, 
    <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'First name'</span>), 
    <span style="color: #8b2252;">'#required'</span> =&gt; <span style="color: #008b8b;">TRUE</span>, 
    <span style="color: #8b2252;">'#default_value'</span> =&gt; <span style="color: #8b2252;">"First name"</span>, <span style="color: #b22222;">// </span><span style="color: #b22222;">added default value. </span>
    <span style="color: #8b2252;">'#description'</span> =&gt; <span style="color: #8b2252;">"Please enter your first name."</span>, <span style="color: #b22222;">// </span><span style="color: #b22222;">added description </span>
    <span style="color: #8b2252;">'#size'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">20</span>, <span style="color: #b22222;">// </span><span style="color: #b22222;">added </span>
    <span style="color: #8b2252;">'#maxlength'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">20</span>, <span style="color: #b22222;">// </span><span style="color: #b22222;">added</span>
  );
  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'name'</span>][<span style="color: #8b2252;">'last'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'textfield'</span>, 
    <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'Last name'</span>), 
    <span style="color: #8b2252;">'#required'</span> =&gt; <span style="color: #008b8b;">TRUE</span>,
  );
  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'submit'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'submit'</span>, 
    <span style="color: #8b2252;">'#value'</span> =&gt; <span style="color: #8b2252;">'Submit'</span>,
  );
  <span style="color: #a020f0;">return</span> $<span style="color: #a0522d;">form</span>;
}
<span style="color: #483d8b;">?&gt;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-3-8" class="outline-3">
<h3 id="sec-3-8">Formulario Básico con Manejador de la Validación</h3>
<div class="outline-text-3" id="text-3-8">
<p>
Ahora se va a introducir un campo fecha en el que solo podamos
introducir valores entre 1900 y el 2000.
</p>

<div class="org-src-container">

<pre class="src src-php"><span style="color: #a020f0;">function</span> <span style="color: #0000ff;">form_example_tutorial_6</span>($<span style="color: #a0522d;">form</span>, &amp;$<span style="color: #a0522d;">form_state</span>) {
  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'description'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'item'</span>,
    <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'A form with a validation handler'</span>),
  );

  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'name'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'fieldset'</span>,
    <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'Name'</span>),
    <span style="color: #8b2252;">'#collapsible'</span> =&gt; <span style="color: #008b8b;">TRUE</span>,
    <span style="color: #8b2252;">'#collapsed'</span> =&gt; <span style="color: #008b8b;">FALSE</span>,
  );
  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'name'</span>][<span style="color: #8b2252;">'first'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'textfield'</span>,
    <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'First name'</span>),
    <span style="color: #8b2252;">'#required'</span> =&gt; <span style="color: #008b8b;">TRUE</span>,
    <span style="color: #8b2252;">'#default_value'</span> =&gt; <span style="color: #8b2252;">"First name"</span>,
    <span style="color: #8b2252;">'#description'</span> =&gt; <span style="color: #8b2252;">"Please enter your first name."</span>,
    <span style="color: #8b2252;">'#size'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">20</span>,
    <span style="color: #8b2252;">'#maxlength'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">20</span>,
  );
  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'name'</span>][<span style="color: #8b2252;">'last'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'textfield'</span>,
    <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'Last name'</span>),
    <span style="color: #8b2252;">'#required'</span> =&gt; <span style="color: #008b8b;">TRUE</span>,
  );

  <span style="color: #b22222;">// </span><span style="color: #b22222;">New form field added to permit entry of year of birth.</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">The data entered into this field will be validated with</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">the default validation function.</span>
  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'year_of_birth'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'textfield'</span>,
    <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #8b2252;">"Year of birth"</span>,
    <span style="color: #8b2252;">'#description'</span> =&gt; <span style="color: #8b2252;">'Format is "YYYY"'</span>,
  );

  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'submit'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'submit'</span>,
    <span style="color: #8b2252;">'#value'</span> =&gt; <span style="color: #8b2252;">'Submit'</span>,
  );
  <span style="color: #a020f0;">return</span> $<span style="color: #a0522d;">form</span>;
}



<span style="color: #b22222;">/**</span>
<span style="color: #b22222;"> * Now we add a handler/function to validate the data entered into the</span>
<span style="color: #b22222;"> * "year of birth" field to make sure it's between the values of 1900</span>
<span style="color: #b22222;"> * and 2000. If not, it displays an error. The value report is</span>
<span style="color: #b22222;"> * $form_state['values'] (see http://drupal.org/node/144132#form-state).</span>
<span style="color: #b22222;"> *</span>
<span style="color: #b22222;"> * Notice the name of the function. It is simply the name of the form</span>
<span style="color: #b22222;"> * followed by '_validate'. This is always the name of the default validation</span>
<span style="color: #b22222;"> * function. An alternate list of validation functions could have been provided</span>
<span style="color: #b22222;"> * in $form['#validate'].</span>
<span style="color: #b22222;"> *</span>
<span style="color: #b22222;"> * @see form_example_tutorial_6()</span>
<span style="color: #b22222;"> *</span>
<span style="color: #b22222;"> </span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">form_example_tutorial_6_validate</span>($<span style="color: #a0522d;">form</span>, &amp;$<span style="color: #a0522d;">form_state</span>) {
  $<span style="color: #a0522d;">year_of_birth</span> = $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'values'</span>][<span style="color: #8b2252;">'year_of_birth'</span>];
  <span style="color: #a020f0;">if</span> ($<span style="color: #a0522d;">year_of_birth</span> &amp;&amp; ($<span style="color: #a0522d;">year_of_birth</span> &lt; <span style="color: #000000; background-color: #ffffff;">1900</span> || $<span style="color: #a0522d;">year_of_birth</span> <span style="color: #008b8b;">&gt;</span> <span style="color: #000000; background-color: #ffffff;">2000</span>)) {
    <span style="color: #000000; background-color: #ffffff;">form_set_error(</span><span style="color: #8b2252;">'year_of_birth'</span>, <span style="color: #8b2252;">'Enter a year between 1900 and 2000.'</span>);
  }
}
</pre>
</div>

<p>
Como se ahora aparece al final del código una nueva función
(form<sub>example</sub><sub>tutorial</sub><sub>6</sub><sub>validate</sub>) que es la que hace la validación.
</p>
</div>
</div>
<div id="outline-container-sec-3-9" class="outline-3">
<h3 id="sec-3-9">Formulario con un manejador de submit</h3>
<div class="outline-text-3" id="text-3-9">
<div class="org-src-container">

<pre class="src src-php"><span style="color: #a020f0;">function</span> <span style="color: #0000ff;">form_example_tutorial_7</span>($<span style="color: #a0522d;">form</span>, &amp;$<span style="color: #a0522d;">form_state</span>) {
  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'description'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'item'</span>,
    <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'A form with a submit handler'</span>),
  );
  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'name'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'fieldset'</span>,
    <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'Name'</span>),
    <span style="color: #8b2252;">'#collapsible'</span> =&gt; <span style="color: #008b8b;">TRUE</span>,
    <span style="color: #8b2252;">'#collapsed'</span> =&gt; <span style="color: #008b8b;">FALSE</span>,
  );
  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'name'</span>][<span style="color: #8b2252;">'first'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'textfield'</span>,
    <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'First name'</span>),
    <span style="color: #8b2252;">'#required'</span> =&gt; <span style="color: #008b8b;">TRUE</span>,
    <span style="color: #8b2252;">'#default_value'</span> =&gt; <span style="color: #8b2252;">"First name"</span>,
    <span style="color: #8b2252;">'#description'</span> =&gt; <span style="color: #8b2252;">"Please enter your first name."</span>,
    <span style="color: #8b2252;">'#size'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">20</span>,
    <span style="color: #8b2252;">'#maxlength'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">20</span>,
  );
  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'name'</span>][<span style="color: #8b2252;">'last'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'textfield'</span>,
    <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'Last name'</span>),
    <span style="color: #8b2252;">'#required'</span> =&gt; <span style="color: #008b8b;">TRUE</span>,
  );
  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'year_of_birth'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'textfield'</span>,
    <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #8b2252;">"Year of birth"</span>,
    <span style="color: #8b2252;">'#description'</span> =&gt; <span style="color: #8b2252;">'Format is "YYYY"'</span>,
  );
  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'submit'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'submit'</span>,
    <span style="color: #8b2252;">'#value'</span> =&gt; <span style="color: #8b2252;">'Submit'</span>,
  );
  <span style="color: #a020f0;">return</span> $<span style="color: #a0522d;">form</span>;
}


<span style="color: #b22222;">/**</span>
<span style="color: #b22222;"> * Validation function for form_example_tutorial_7().</span>
<span style="color: #b22222;"> *</span>
<span style="color: #b22222;"> </span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">form_example_tutorial_7_validate</span>($<span style="color: #a0522d;">form</span>, &amp;$<span style="color: #a0522d;">form_state</span>) {
  $<span style="color: #a0522d;">year_of_birth</span> = $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'values'</span>][<span style="color: #8b2252;">'year_of_birth'</span>];
  <span style="color: #a020f0;">if</span> ($<span style="color: #a0522d;">year_of_birth</span> &amp;&amp; ($<span style="color: #a0522d;">year_of_birth</span> &lt; <span style="color: #000000; background-color: #ffffff;">1900</span> || $<span style="color: #a0522d;">year_of_birth</span> <span style="color: #008b8b;">&gt;</span> <span style="color: #000000; background-color: #ffffff;">2000</span>)) {
    <span style="color: #000000; background-color: #ffffff;">form_set_error(</span><span style="color: #8b2252;">'year_of_birth'</span>, <span style="color: #8b2252;">'Enter a year between 1900 and 2000.'</span>);
  }
}

<span style="color: #b22222;">/**</span>
<span style="color: #b22222;"> * Submit function for form_example_tutorial_7().</span>
<span style="color: #b22222;"> *</span>
<span style="color: #b22222;"> * Adds a submit handler/function to our form to send a successful</span>
<span style="color: #b22222;"> * completion message to the screen.</span>
<span style="color: #b22222;"> </span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">form_example_tutorial_7_submit</span>($<span style="color: #a0522d;">form</span>, &amp;$<span style="color: #a0522d;">form_state</span>) {
  <span style="color: #000000; background-color: #ffffff;">drupal_set_message(t(</span><span style="color: #8b2252;">'The form has been submitted. name="@first @last", year of birth=@year_of_birth'</span>,
    <span style="color: #000000; background-color: #ffffff;">array(</span><span style="color: #8b2252;">'@first'</span> =&gt; $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'values'</span>][<span style="color: #8b2252;">'first'</span>], <span style="color: #8b2252;">'@last'</span> =&gt; $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'values'</span>][<span style="color: #8b2252;">'last'</span>], <span style="color: #8b2252;">'@year_of_birth'</span> =&gt; $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'values'</span>][<span style="color: #8b2252;">'year_of_birth'</span>])));
}
</pre>
</div>

<p>
En este ejemplo, de nuevo aparece validate, aunque lo importante es
form\<sub>example\</sub><sub>tutorial\</sub><sub>7\</sub><sub>submit</sub>. Esta función imprime un mensaje con
los valores introducidos en el formulario. Este manejador también nos
puede servir para grabar los datos como se verá en posteriores
ejemplos.
</p>
</div>
</div>
<div id="outline-container-sec-3-10" class="outline-3">
<h3 id="sec-3-10">Un Formulario de Múltiples Pasos</h3>
<div class="outline-text-3" id="text-3-10">
<div class="org-src-container">

<pre class="src src-php"><span style="color: #a020f0;">function</span> <span style="color: #0000ff;">form_tutorial_my_form</span>($<span style="color: #a0522d;">form</span>, &amp;$<span style="color: #a0522d;">form_state</span>) {

  <span style="color: #b22222;">// </span><span style="color: #b22222;">Display page 2 if $form_state['page_num'] == 1</span>
  <span style="color: #a020f0;">if</span> (!<span style="color: #000000; background-color: #ffffff;">empty(</span>$<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'page_num'</span>]) &amp;&amp; $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'page_num'</span>] == <span style="color: #000000; background-color: #ffffff;">2</span>) {
    <span style="color: #a020f0;">return</span> <span style="color: #000000; background-color: #ffffff;">form_tutorial_my_form_page_two(</span>$<span style="color: #a0522d;">form</span>, $<span style="color: #a0522d;">form_state</span>);
  }

  <span style="color: #b22222;">// </span><span style="color: #b22222;">Otherwise we build page 1.</span>
  $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'page_num'</span>] = <span style="color: #000000; background-color: #ffffff;">1</span>;

  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'description'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'item'</span>,
    <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'A basic multistep form (page 1)'</span>),
  );

  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'first'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'textfield'</span>,
    <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'First name'</span>),
    <span style="color: #8b2252;">'#description'</span> =&gt; <span style="color: #8b2252;">"Please enter your first name."</span>,
    <span style="color: #8b2252;">'#size'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">20</span>,
    <span style="color: #8b2252;">'#maxlength'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">20</span>,
    <span style="color: #8b2252;">'#required'</span> =&gt; <span style="color: #008b8b;">TRUE</span>,
    <span style="color: #8b2252;">'#default_value'</span> =&gt; !<span style="color: #000000; background-color: #ffffff;">empty(</span>$<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'values'</span>][<span style="color: #8b2252;">'first'</span>]) ? $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'values'</span>][<span style="color: #8b2252;">'first'</span>] : <span style="color: #8b2252;">''</span>,
  );
  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'last'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'textfield'</span>,
    <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'Last name'</span>),
    <span style="color: #8b2252;">'#default_value'</span> =&gt; !<span style="color: #000000; background-color: #ffffff;">empty(</span>$<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'values'</span>][<span style="color: #8b2252;">'last'</span>]) ? $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'values'</span>][<span style="color: #8b2252;">'last'</span>] : <span style="color: #8b2252;">''</span>,
  );
  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'year_of_birth'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'textfield'</span>,
    <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #8b2252;">"Year of birth"</span>,
    <span style="color: #8b2252;">'#description'</span> =&gt; <span style="color: #8b2252;">'Format is "YYYY"'</span>,
    <span style="color: #8b2252;">'#default_value'</span> =&gt; !<span style="color: #000000; background-color: #ffffff;">empty(</span>$<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'values'</span>][<span style="color: #8b2252;">'year_of_birth'</span>]) ? $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'values'</span>][<span style="color: #8b2252;">'year_of_birth'</span>] : <span style="color: #8b2252;">''</span>,
  );
  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'next'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'submit'</span>,
    <span style="color: #8b2252;">'#value'</span> =&gt; <span style="color: #8b2252;">'Next &gt;&gt;'</span>,
    <span style="color: #8b2252;">'#submit'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">array(</span><span style="color: #8b2252;">'form_tutorial_my_form_next_submit'</span>),
    <span style="color: #8b2252;">'#validate'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">array(</span><span style="color: #8b2252;">'form_tutorial_my_form_next_validate'</span>),
  );
  <span style="color: #a020f0;">return</span> $<span style="color: #a0522d;">form</span>;
}

<span style="color: #b22222;">/**</span>
<span style="color: #b22222;"> * Returns the form for the second page of form_tutorial_my_form().</span>
<span style="color: #b22222;"> </span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">form_tutorial_my_form_page_two</span>($<span style="color: #a0522d;">form</span>, &amp;$<span style="color: #a0522d;">form_state</span>) {
  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'description'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'item'</span>,
    <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'A basic multistep form (page 2)'</span>),
  );

  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'color'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'textfield'</span>,
    <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'Favorite color'</span>),
    <span style="color: #8b2252;">'#required'</span> =&gt; <span style="color: #008b8b;">TRUE</span>,
    <span style="color: #8b2252;">'#default_value'</span> =&gt; !<span style="color: #000000; background-color: #ffffff;">empty(</span>$<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'values'</span>][<span style="color: #8b2252;">'color'</span>]) ? $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'values'</span>][<span style="color: #8b2252;">'color'</span>] : <span style="color: #8b2252;">''</span>,
  );
  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'submit'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'submit'</span>,
    <span style="color: #8b2252;">'#value'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'Submit'</span>),
    <span style="color: #8b2252;">'#submit'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">array(</span><span style="color: #8b2252;">'form_tutorial_my_form_page_two_submit'</span>),
  );
  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'back'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'submit'</span>,
    <span style="color: #8b2252;">'#value'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'&lt;&lt; Back'</span>),
    <span style="color: #8b2252;">'#submit'</span> =<span style="color: #008b8b;">&gt;</span> <span style="color: #000000; background-color: #ffffff;">array(</span><span style="color: #8b2252;">'form_tutorial_my_form_page_two_back'</span>),
    <span style="color: #b22222;">// </span><span style="color: #b22222;">We won't bother validating the required 'color' field, since they</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">have to come back to this page to submit anyway.</span>
    <span style="color: #8b2252;">'#limit_validation_errors'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">array(</span>),
  );
  <span style="color: #a020f0;">return</span> $<span style="color: #a0522d;">form</span>;
}


<span style="color: #b22222;">/**</span>
<span style="color: #b22222;"> * Validate handler for the next button on first page.</span>
<span style="color: #b22222;"> *</span>
<span style="color: #b22222;"> </span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">form_tutorial_my_form_next_validate</span>($<span style="color: #a0522d;">form</span>, &amp;$<span style="color: #a0522d;">form_state</span>) {
  $<span style="color: #a0522d;">year_of_birth</span> = $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'values'</span>][<span style="color: #8b2252;">'year_of_birth'</span>];
  <span style="color: #a020f0;">if</span> ($<span style="color: #a0522d;">year_of_birth</span> &amp;&amp; ($<span style="color: #a0522d;">year_of_birth</span> &lt; <span style="color: #000000; background-color: #ffffff;">1900</span> || $<span style="color: #a0522d;">year_of_birth</span> <span style="color: #008b8b;">&gt;</span> <span style="color: #000000; background-color: #ffffff;">2000</span>)) {
    <span style="color: #000000; background-color: #ffffff;">form_set_error(</span><span style="color: #8b2252;">'year_of_birth'</span>, <span style="color: #8b2252;">'Enter a year between 1900 and 2000.'</span>);
  }
}

<span style="color: #b22222;">/**</span>
<span style="color: #b22222;"> * Submit handler for form_tutorial_my_form() next button.</span>
<span style="color: #b22222;"> *</span>
<span style="color: #b22222;"> * Capture the values from page one and store them away so they can be used</span>
<span style="color: #b22222;"> * at final submit time.</span>
<span style="color: #b22222;"> *</span>
<span style="color: #b22222;"> </span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">form_tutorial_my_form_next_submit</span>($<span style="color: #a0522d;">form</span>, &amp;$<span style="color: #a0522d;">form_state</span>) {

  <span style="color: #b22222;">// </span><span style="color: #b22222;">Values are saved for each page.</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">to carry forward to subsequent pages in the form.</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">and we tell FAPI to rebuild the form.</span>
  $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'page_values'</span>][<span style="color: #000000; background-color: #ffffff;">1</span>] = $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'values'</span>];

  <span style="color: #a020f0;">if</span> (!<span style="color: #000000; background-color: #ffffff;">empty(</span>$<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'page_values'</span>][<span style="color: #000000; background-color: #ffffff;">2</span>])) {
    $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'values'</span>] = $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'page_values'</span>][<span style="color: #000000; background-color: #ffffff;">2</span>];
  }

  <span style="color: #b22222;">// </span><span style="color: #b22222;">When form rebuilds, it will look at this to figure which page to build.</span>
  $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'page_num'</span>] = <span style="color: #000000; background-color: #ffffff;">2</span>;
  $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'rebuild'</span>] = <span style="color: #008b8b;">TRUE</span>;
}

<span style="color: #b22222;">/**</span>
<span style="color: #b22222;"> * Back button handler submit handler.</span>
<span style="color: #b22222;"> *</span>
<span style="color: #b22222;"> * Since #limit_validation_errors = array() is set, values from page 2</span>
<span style="color: #b22222;"> * will be discarded. We load the page 1 values instead.</span>
<span style="color: #b22222;"> </span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">form_tutorial_my_form_page_two_back</span>($<span style="color: #a0522d;">form</span>, &amp;$<span style="color: #a0522d;">form_state</span>) {
  $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'values'</span>] = $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'page_values'</span>][<span style="color: #000000; background-color: #ffffff;">1</span>];
  $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'page_num'</span>] = <span style="color: #000000; background-color: #ffffff;">1</span>;
  $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'rebuild'</span>] = <span style="color: #008b8b;">TRUE</span>;
}

<span style="color: #b22222;">/**</span>
<span style="color: #b22222;"> * The page 2 submit handler.</span>
<span style="color: #b22222;"> *</span>
<span style="color: #b22222;"> * This is the final submit handler. Gather all the data together and output</span>
<span style="color: #b22222;"> * it in a drupal_set_message().</span>
<span style="color: #b22222;"> </span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">form_tutorial_my_form_page_two_submit</span>($<span style="color: #a0522d;">form</span>, &amp;$<span style="color: #a0522d;">form_state</span>) {
  <span style="color: #b22222;">// </span><span style="color: #b22222;">Normally, some code would go here to alter the database with the data</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">collected from the form. Instead sets a message with drupal_set_message()</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">to validate that the code worked.</span>
  $<span style="color: #a0522d;">page_one_values</span> = $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'page_values'</span>][<span style="color: #000000; background-color: #ffffff;">1</span>];
  <span style="color: #000000; background-color: #ffffff;">drupal_set_message(t(</span><span style="color: #8b2252;">'The form has been submitted. name="@first @last", year of birth=@year_of_birth'</span>,
  <span style="color: #000000; background-color: #ffffff;">array(</span><span style="color: #8b2252;">'@first'</span> =&gt; $<span style="color: #a0522d;">page_one_values</span>[<span style="color: #8b2252;">'first'</span>], <span style="color: #8b2252;">'@last'</span> =&gt; $<span style="color: #a0522d;">page_one_values</span>[<span style="color: #8b2252;">'last'</span>], <span style="color: #8b2252;">'@year_of_birth'</span> =&gt; $<span style="color: #a0522d;">page_one_values</span>[<span style="color: #8b2252;">'year_of_birth'</span>])));

  <span style="color: #a020f0;">if</span> (!<span style="color: #000000; background-color: #ffffff;">empty(</span>$<span style="color: #a0522d;">page_one_values</span>[<span style="color: #8b2252;">'first2'</span>])) {
    <span style="color: #000000; background-color: #ffffff;">drupal_set_message(t(</span><span style="color: #8b2252;">'Second name: name="@first @last", year of birth=@year_of_birth'</span>,
    <span style="color: #000000; background-color: #ffffff;">array(</span><span style="color: #8b2252;">'@first'</span> =&gt; $<span style="color: #a0522d;">page_one_values</span>[<span style="color: #8b2252;">'first2'</span>], <span style="color: #8b2252;">'@last'</span> =&gt; $<span style="color: #a0522d;">page_one_values</span>[<span style="color: #8b2252;">'last2'</span>], <span style="color: #8b2252;">'@year_of_birth'</span> =&gt; $<span style="color: #a0522d;">page_one_values</span>[<span style="color: #8b2252;">'year_of_birth2'</span>])));
  }
  <span style="color: #000000; background-color: #ffffff;">drupal_set_message(t(</span><span style="color: #8b2252;">'And the favorite color is @color'</span>, <span style="color: #000000; background-color: #ffffff;">array(</span><span style="color: #8b2252;">'@color'</span> =&gt; $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'values'</span>][<span style="color: #8b2252;">'color'</span>])));

  <span style="color: #b22222;">// </span><span style="color: #b22222;">If we wanted to redirect on submission, set $form_state['redirect']</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">$form_state['redirect'] = 'node'; // Redirects the user to /node.</span>
}
</pre>
</div>

<p>
Este código tiene dos funciones form principales:
form\<sub>tutorial\</sub><sub>my\</sub><sub>form</sub> y form\<sub>tutorial\</sub><sub>my\</sub><sub>form\</sub><sub>page\</sub><sub>two</sub>. En
cada una de las funciones se definen los campos que va a haber en cada
una de las páginas del formulario. Al principio de
form\<sub>tutorial\</sub><sub>my\</sub><sub>form</sub> hay una condición que manda a
form\<sub>tutorial\</sub><sub>my\</sub><sub>form\</sub><sub>page\</sub><sub>two</sub> si $form\<sub>state['page</sub><sub>num']</sub> == 2.
</p>

<p>
En cada uno de los submit se envía a los correspondientes manejadores
de submit. En el primero se establece $form<sub>state['page</sub><sub>num']</sub> a 2 y se
guardan en una variable los valores de $form\<sub>state['values']</sub>. Y en el
segundo submit se muestran por pantalla los valores que se han ido
introduciendo en ambas páginas del formulario. También hay definida
una función para regresar al punto anterior.
</p>
</div>
</div>
<div id="outline-container-sec-3-11" class="outline-3">
<h3 id="sec-3-11">Un Formulario con Campos Dinámicos</h3>
<div class="outline-text-3" id="text-3-11">
<p>
En este formulario los fieldset de tipo nombre van a ser dinámicos,
esto es, iremos añadiendo fieldset según le demos al botón añadir
nombre. Ahora el código para hacer esto:
</p>

<div class="org-src-container">

<pre class="src src-php"><span style="color: #a020f0;">function</span> <span style="color: #0000ff;">form_tutorial_my_form</span>($<span style="color: #a0522d;">form</span>, &amp;$<span style="color: #a0522d;">form_state</span>) {

  <span style="color: #b22222;">// </span><span style="color: #b22222;">We will have many fields with the same name, so we need to be able to</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">access the form hierarchically.</span>
  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'#tree'</span>] = <span style="color: #008b8b;">TRUE</span>;

  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'description'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'item'</span>,
    <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'A form with dynamically added new fields'</span>),
  );

  <span style="color: #a020f0;">if</span> (<span style="color: #000000; background-color: #ffffff;">empty(</span>$<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'num_names'</span>])) {
    $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'num_names'</span>] = <span style="color: #000000; background-color: #ffffff;">1</span>;
  }

  <span style="color: #b22222;">// </span><span style="color: #b22222;">Build the number of name fieldsets indicated by $form_state['num_names']</span>
  <span style="color: #a020f0;">for</span> ($<span style="color: #a0522d;">i</span> = <span style="color: #000000; background-color: #ffffff;">1</span>; $<span style="color: #a0522d;">i</span> &lt;= $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'num_names'</span>]; $<span style="color: #a0522d;">i</span>++) {
    $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'name'</span>][$<span style="color: #a0522d;">i</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
      <span style="color: #8b2252;">'#type'</span> =<span style="color: #008b8b;">&gt;</span> <span style="color: #8b2252;">'fieldset'</span>,
      <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'Name #@num'</span>, <span style="color: #000000; background-color: #ffffff;">array(</span><span style="color: #8b2252;">'@num'</span> =&gt; $<span style="color: #a0522d;">i</span>)),
      <span style="color: #8b2252;">'#collapsible'</span> =&gt; <span style="color: #008b8b;">TRUE</span>,
      <span style="color: #8b2252;">'#collapsed'</span> =&gt; <span style="color: #008b8b;">FALSE</span>,
    );

    $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'name'</span>][$<span style="color: #a0522d;">i</span>][<span style="color: #8b2252;">'first'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
      <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'textfield'</span>,
      <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'First name'</span>),
      <span style="color: #8b2252;">'#description'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">"Enter first name."</span>),
      <span style="color: #8b2252;">'#size'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">20</span>,
      <span style="color: #8b2252;">'#maxlength'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">20</span>,
      <span style="color: #8b2252;">'#required'</span> =&gt; <span style="color: #008b8b;">TRUE</span>,
    );
    $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'name'</span>][$<span style="color: #a0522d;">i</span>][<span style="color: #8b2252;">'last'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
      <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'textfield'</span>,
      <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'Enter Last name'</span>),
      <span style="color: #8b2252;">'#required'</span> =&gt; <span style="color: #008b8b;">TRUE</span>,
    );
    $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'name'</span>][$<span style="color: #a0522d;">i</span>][<span style="color: #8b2252;">'year_of_birth'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
      <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'textfield'</span>,
      <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">"Year of birth"</span>),
      <span style="color: #8b2252;">'#description'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'Format is "YYYY"'</span>),
    );
  }
  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'submit'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'submit'</span>,
    <span style="color: #8b2252;">'#value'</span> =&gt; <span style="color: #8b2252;">'Submit'</span>,
  );

  <span style="color: #b22222;">// </span><span style="color: #b22222;">Adds "Add another name" button</span>
  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'add_name'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'submit'</span>,
    <span style="color: #8b2252;">'#value'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'Add another name'</span>),
    <span style="color: #8b2252;">'#submit'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">array(</span><span style="color: #8b2252;">'form_tutorial_my_form_add_name'</span>),
  );

  <span style="color: #b22222;">// </span><span style="color: #b22222;">If we have more than one name, this button allows removal of the</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">last name.</span>
  <span style="color: #a020f0;">if</span> ($<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'num_names'</span>] &gt; <span style="color: #000000; background-color: #ffffff;">1</span>) {
    $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'remove_name'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
      <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'submit'</span>,
      <span style="color: #8b2252;">'#value'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'Remove latest name'</span>),
      <span style="color: #8b2252;">'#submit'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">array(</span><span style="color: #8b2252;">'form_tutorial_my_form_remove_name'</span>),
      <span style="color: #b22222;">// </span><span style="color: #b22222;">Since we are removing a name, don't validate until later.</span>
      <span style="color: #8b2252;">'#limit_validation_errors'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">array(</span>),
    );
  }

  <span style="color: #a020f0;">return</span> $<span style="color: #a0522d;">form</span>;
}

<span style="color: #b22222;">/**</span>
<span style="color: #b22222;">  Submit handler for "Add another name" button on form_tutorial_my_form().</span>

<span style="color: #b22222;">  $form_state['num_names'] tells the form builder function how many name</span>
<span style="color: #b22222;">  fieldsets to build, so here we increment it.</span>

<span style="color: #b22222;">  All elements of $form_state are persisted, so there's no need to use a</span>
<span style="color: #b22222;">  particular key, like the old $form_state['storage']. We can just use</span>
<span style="color: #b22222;">  $form_state['num_names'].</span>
<span style="color: #b22222;"> </span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">form_tutorial_my_form_add_name</span>($<span style="color: #a0522d;">form</span>, &amp;$<span style="color: #a0522d;">form_state</span>) {
  <span style="color: #b22222;">// </span><span style="color: #b22222;">Everything in $form_state is persistent, so we'll just use</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">$form_state['add_name']</span>
  $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'num_names'</span>]++;

  <span style="color: #b22222;">// </span><span style="color: #b22222;">Setting $form_state['rebuild'] = TRUE causes the form to be rebuilt again.</span>
  $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'rebuild'</span>] = <span style="color: #008b8b;">TRUE</span>;
}


<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">form_tutorial_my_form_remove_name</span>($<span style="color: #a0522d;">form</span>, &amp;$<span style="color: #a0522d;">form_state</span>) {
  <span style="color: #a020f0;">if</span> ($<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'num_names'</span>] &gt; <span style="color: #000000; background-color: #ffffff;">1</span>) {
    $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'num_names'</span>]--;
  }

  <span style="color: #b22222;">// </span><span style="color: #b22222;">Setting $form_state['rebuild'] = TRUE causes the form to be rebuilt again.</span>
  $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'rebuild'</span>] = <span style="color: #008b8b;">TRUE</span>;
}

<span style="color: #b22222;">/**</span>
<span style="color: #b22222;">  Validate function for form_tutorial_my_form().</span>

<span style="color: #b22222;">  Adds logic to validate the form to check the validity of the new fields,</span>
<span style="color: #b22222;">  if they exist.</span>
<span style="color: #b22222;"> </span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">form_tutorial_my_form_validate</span>($<span style="color: #a0522d;">form</span>, &amp;$<span style="color: #a0522d;">form_state</span>) {

  <span style="color: #a020f0;">for</span> ($<span style="color: #a0522d;">i</span> = <span style="color: #000000; background-color: #ffffff;">1</span>; $<span style="color: #a0522d;">i</span> &lt;= $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'num_names'</span>]; $<span style="color: #a0522d;">i</span>++) {
    $<span style="color: #a0522d;">year_of_birth</span> = $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'values'</span>][<span style="color: #8b2252;">'name'</span>][$<span style="color: #a0522d;">i</span>][<span style="color: #8b2252;">'year_of_birth'</span>];

    <span style="color: #a020f0;">if</span> ($<span style="color: #a0522d;">year_of_birth</span> &amp;&amp; ($<span style="color: #a0522d;">year_of_birth</span> &lt; <span style="color: #000000; background-color: #ffffff;">1900</span> || $<span style="color: #a0522d;">year_of_birth</span> <span style="color: #008b8b;">&gt;</span> <span style="color: #000000; background-color: #ffffff;">2000</span>)) {
      <span style="color: #000000; background-color: #ffffff;">form_set_error(</span><span style="color: #8b2252;">"name][$i][year_of_birth"</span>, <span style="color: #8b2252;">'Enter a year between 1900 and 2000.'</span>);
    }
  }
}

<span style="color: #b22222;">/**</span>
<span style="color: #b22222;"> * Submit function for form_tutorial_my_form().</span>
<span style="color: #b22222;"> </span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">form_tutorial_my_form_submit</span>($<span style="color: #a0522d;">form</span>, &amp;$<span style="color: #a0522d;">form_state</span>) {
  $<span style="color: #a0522d;">output</span> = <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">"Form 9 has been submitted. "</span>);
  <span style="color: #a020f0;">for</span> ($<span style="color: #a0522d;">i</span> = <span style="color: #000000; background-color: #ffffff;">1</span>; $<span style="color: #a0522d;">i</span> &lt;= $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'num_names'</span>]; $<span style="color: #a0522d;">i</span>++) {
    $<span style="color: #a0522d;">output</span> .= <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">"@num: @first @last (@date)... "</span>, <span style="color: #000000; background-color: #ffffff;">array(</span><span style="color: #8b2252;">'@num'</span> =<span style="color: #008b8b;">&gt;</span> $<span style="color: #a0522d;">i</span>, <span style="color: #8b2252;">'@first'</span> =&gt; $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'values'</span>][<span style="color: #8b2252;">'name'</span>][$<span style="color: #a0522d;">i</span>][<span style="color: #8b2252;">'first'</span>],
      <span style="color: #8b2252;">'@last'</span> =&gt;  $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'values'</span>][<span style="color: #8b2252;">'name'</span>][$<span style="color: #a0522d;">i</span>][<span style="color: #8b2252;">'last'</span>], <span style="color: #8b2252;">'@date'</span> =&gt;  $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'values'</span>][<span style="color: #8b2252;">'name'</span>][$<span style="color: #a0522d;">i</span>][<span style="color: #8b2252;">'year_of_birth'</span>]));
  }
  <span style="color: #000000; background-color: #ffffff;">drupal_set_message(</span>$<span style="color: #a0522d;">output</span>);
}
</pre>
</div>

<p>
En form<sub>tutorial</sub><sub>my</sub><sub>form</sub> se define $form['#tree'] = TRUE; para poder
soportar campos dinámicos. Así mismo, la variable
$form\<sub>state['num</sub><sub>names']</sub> llevará el conteo de cuántos fieldset hay y
se inicializa a 1. Para definir los campos del formulario se utiliza
un bucle que se repete tantas veces como fieldsets nombre hay. Hay
tres campos de tipo submit: el de enviar el formulario, el de añadir
un nuevo fieldset nombre y el de eliminar el último fieldset nombre
añadido.
</p>

<p>
Los manejadores de submit de añadir y eliminar fieldset nombre
actualizan la variable $form\<sub>state['num</sub><sub>names']</sub> y reconstruyen el
formulario con $form\<sub>state['rebuild']</sub> = TRUE;. El manejador de envío
muestra todos los valores en pantalla.
</p>
</div>
</div>
<div id="outline-container-sec-3-12" class="outline-3">
<h3 id="sec-3-12">Formulario para Subir un Fichero a Drupal</h3>
<div class="outline-text-3" id="text-3-12">
<p>
Este ejemplo permite al usuario subir un fichero a Drupal que es
almacenado físicamente y con una referencia en la base de datos.
</p>

<div class="org-src-container">

<pre class="src src-php"><span style="color: #a020f0;">function</span> <span style="color: #0000ff;">form_tutorial_my_form</span>($<span style="color: #a0522d;">form_state</span>) {
  <span style="color: #b22222;">// </span><span style="color: #b22222;">enctype="multipart/form-data" required by browsers to handle files.</span>
  $<span style="color: #a0522d;">form</span> = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#attributes'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">array(</span><span style="color: #8b2252;">'enctype'</span> =&gt; <span style="color: #8b2252;">"multipart/form-data"</span>),
  );

  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'file'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'file'</span>,
        <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'Image'</span>),
        <span style="color: #8b2252;">'#description'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'Upload a file, allowed extensions: jpg, jpeg, png, gif'</span>),
  );

  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'submit'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'submit'</span>,
    <span style="color: #8b2252;">'#value'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'Submit'</span>),
  );

  <span style="color: #a020f0;">return</span> $<span style="color: #a0522d;">form</span>;
}

<span style="color: #b22222;">/**</span>
<span style="color: #b22222;"> * Validate handler for form_tutorial_my_form().</span>
<span style="color: #b22222;"> </span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">form_tutorial_my_form_validate</span>($<span style="color: #a0522d;">form</span>, &amp;$<span style="color: #a0522d;">form_state</span>) {
        $<span style="color: #a0522d;">file</span> = <span style="color: #000000; background-color: #ffffff;">file_save_upload(</span><span style="color: #8b2252;">'file'</span>, <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'file_validate_is_image'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">array(</span>), <span style="color: #b22222;">// </span><span style="color: #b22222;">Validates file is really an image.</span>
    <span style="color: #8b2252;">'file_validate_extensions'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">array(</span><span style="color: #8b2252;">'png gif jpg jpeg'</span>), <span style="color: #b22222;">// </span><span style="color: #b22222;">Validate extensions.</span>
  ));
  <span style="color: #b22222;">// </span><span style="color: #b22222;">If the file passed validation:</span>
  <span style="color: #a020f0;">if</span> ($<span style="color: #a0522d;">file</span>) {
    <span style="color: #b22222;">// </span><span style="color: #b22222;">Move the file, into the Drupal file system</span>
    <span style="color: #a020f0;">if</span> ($<span style="color: #a0522d;">file</span> = <span style="color: #000000; background-color: #ffffff;">file_move(</span>$<span style="color: #a0522d;">file</span>, <span style="color: #8b2252;">'public://'</span>)) {
      <span style="color: #b22222;">// </span><span style="color: #b22222;">Save the file for use in the submit handler.</span>
      $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'storage'</span>][<span style="color: #8b2252;">'file'</span>] = $<span style="color: #a0522d;">file</span>;
    }
    <span style="color: #a020f0;">else</span> {
      <span style="color: #000000; background-color: #ffffff;">form_set_error(</span><span style="color: #8b2252;">'file'</span>, <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'Failed to write the uploaded file the site\'s file folder.'</span>));
    }
  }
  <span style="color: #a020f0;">else</span> {
    <span style="color: #000000; background-color: #ffffff;">form_set_error(</span><span style="color: #8b2252;">'file'</span>, <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'No file was uploaded.'</span>));
  }
}

<span style="color: #b22222;">/**</span>
<span style="color: #b22222;"> * Submit handler for form_tutorial_my_form().</span>
<span style="color: #b22222;"> </span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">form_tutorial_my_form_submit</span>($<span style="color: #a0522d;">form</span>, &amp;$<span style="color: #a0522d;">form_state</span>) {
  $<span style="color: #a0522d;">file</span> = $<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'storage'</span>][<span style="color: #8b2252;">'file'</span>];
  <span style="color: #b22222;">// </span><span style="color: #b22222;">We are done with the file, remove it from storage.</span>
  <span style="color: #000000; background-color: #ffffff;">unset(</span>$<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'storage'</span>][<span style="color: #8b2252;">'file'</span>]);
  <span style="color: #b22222;">// </span><span style="color: #b22222;">Make the storage of the file permanent</span>
  $<span style="color: #a0522d;">file</span>-&gt;<span style="color: #a0522d;">status</span> = <span style="color: #ff0000; font-weight: bold;">FILE_STATUS_PERMANENT</span>;
  <span style="color: #b22222;">// </span><span style="color: #b22222;">Save file status.</span>
  <span style="color: #000000; background-color: #ffffff;">file_save(</span>$<span style="color: #a0522d;">file</span>);
  <span style="color: #b22222;">// </span><span style="color: #b22222;">Set a response to the user.</span>
  <span style="color: #000000; background-color: #ffffff;">drupal_set_message(t(</span><span style="color: #8b2252;">'The form has been submitted and the image has been saved, filename: @filename.'</span>, <span style="color: #000000; background-color: #ffffff;">array(</span><span style="color: #8b2252;">'@filename'</span> =&gt; $<span style="color: #a0522d;">file</span>-&gt;<span style="color: #a0522d;">filename</span>)));
}
</pre>
</div>

<p>
La clave de este código está en las funciones
form<sub>tutorial</sub><sub>my</sub><sub>form</sub><sub>validate</sub> y form<sub>tutorial</sub><sub>my</sub><sub>form</sub><sub>submit</sub>. En la
primera se escribe en el sistema de ficheros el la imagen a subir y en
la segunda se escribe en la base de datos (mediante file<sub>save</sub>) y se
muestra un mensaje con la acción realizada.
</p>
</div>
</div>
<div id="outline-container-sec-3-13" class="outline-3">
<h3 id="sec-3-13">Mail API</h3>
<div class="outline-text-3" id="text-3-13">
<p>
Para familiarizarnos con la api de correo de Drupal se desarrollará un
módulo cuya funcionalidad sea enviar un correo desde un
formulario. Obviamente esta funcionalidad se podría implementar en un
sitio en producción mediante el módulo contact del core ó mediante el
módulo webform. Sin embargo, aprender a hacer esto desarrollando un
módulo nos permitirá afianzar nuestro conocimiento del api de form y
es un ejemplo muy didáctico para aprender el api de correo. Aprender a
hacer las cosas vía construir módulos sencillos permite aprender a
leer y escribir módulos ajenos para poder resolver las necesidades
específicas.
</p>

<p>
El módulo a crear se va a llamar email<sub>example</sub>, por lo que creamos el
directorio email<sub>example</sub> en sites/all/modules y dentro se crea el
fichero email<sub>example</sub>.info:
</p>

<div class="org-src-container">

<pre class="src src-php">; $<span style="color: #a0522d;">Id$</span>

<span style="color: #ff0000; font-weight: bold;">name</span> = <span style="color: #ff0000; font-weight: bold;">E</span>-<span style="color: #ff0000; font-weight: bold;">mail</span> <span style="color: #ff0000; font-weight: bold;">Example</span>
<span style="color: #ff0000; font-weight: bold;">description</span> = <span style="color: #ff0000; font-weight: bold;">Demonstrate</span> <span style="color: #ff0000; font-weight: bold;">Drupal</span><span style="color: #8b2252;">'s e-mail APIs.</span>
<span style="color: #8b2252;">package = Example modules</span>
<span style="color: #8b2252;">core = 7.x</span>

<span style="color: #8b2252;">project = "examples"</span>
</pre>
</div>

<p>
Ahora toca crear el email<sub>example</sub>.module:
</p>

<div class="org-src-container">

<pre class="src src-php"><span style="color: #483d8b;">&lt;?php</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">$Id: email_example.module,v 1.4 2010/03/03 15:48:59 rfay Exp $</span>

<span style="color: #b22222;">/**</span>
<span style="color: #b22222;"> * @file</span>
<span style="color: #b22222;"> * Example of how to use Drupal's mail API.</span>
<span style="color: #b22222;"> *</span>
<span style="color: #b22222;"> * This example module provides two different examples of the Drupal email API.</span>
<span style="color: #b22222;"> *  - defines a simple contact form and shows how to use drupal_mail()</span>
<span style="color: #b22222;"> *    to send an e-mail (defined in hook_mail()) when the form is submitted.</span>
<span style="color: #b22222;"> *  - shows how modules can alter emails defined by other Drupal modules or</span>
<span style="color: #b22222;"> *    Core using hook_mail_alter by attaching a custom signature before</span>
<span style="color: #b22222;"> *    they are sent.</span>
<span style="color: #b22222;"> </span><span style="color: #b22222;">*/</span>

<span style="color: #b22222;">/**</span>
<span style="color: #b22222;"> * Implement hook_mail().</span>
<span style="color: #b22222;"> *</span>
<span style="color: #b22222;"> * This hook defines a list of possible e-mail templates that this module can</span>
<span style="color: #b22222;"> * send. Each e-mail is given a unique identifier, or 'key'.</span>
<span style="color: #b22222;"> *</span>
<span style="color: #b22222;"> * $message comes in with some standard properties already set: 'to' address,</span>
<span style="color: #b22222;"> * 'from' address, and a set of default 'headers' from drupal_mail(). The goal</span>
<span style="color: #b22222;"> * of hook_mail() is to set the message's 'subject' and 'body' properties, as</span>
<span style="color: #b22222;"> * well as make any adjustments to the headers that are necessary.</span>
<span style="color: #b22222;"> *</span>
<span style="color: #b22222;"> * The $params argument is an array which can hold any additional data required</span>
<span style="color: #b22222;"> * to build the mail subject and body; for example, user-entered form data, or</span>
<span style="color: #b22222;"> * some context information as to where the mail request came from.</span>
<span style="color: #b22222;"> *</span>
<span style="color: #b22222;"> * Note that hook_mail() is not actually a hook. It is only called for a single</span>
<span style="color: #b22222;"> * module, the module named in the first argument of drupal_mail(). So it's</span>
<span style="color: #b22222;"> * a callback of a type, but not a hook.</span>
<span style="color: #b22222;"> </span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">email_example_mail</span>($<span style="color: #a0522d;">key</span>, &amp;$<span style="color: #a0522d;">message</span>, $<span style="color: #a0522d;">params</span>) {
  <span style="color: #a020f0;">global</span> $<span style="color: #a0522d;">user</span>;

  <span style="color: #b22222;">// </span><span style="color: #b22222;">Each message is associated with a language, which may or may not be the</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">current user's selected language, depending on the type of e-mail being</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">sent. This $options array is used later in the t() calls for subject</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">and body to ensure the proper translation takes effect.</span>
  $<span style="color: #a0522d;">options</span> = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'langcode'</span> =<span style="color: #008b8b;">&gt;</span> $<span style="color: #a0522d;">message</span>[<span style="color: #8b2252;">'language'</span>]-&gt;<span style="color: #a0522d;">language</span>,
  );

  <span style="color: #a020f0;">switch</span> ($<span style="color: #a0522d;">key</span>) {
    <span style="color: #b22222;">// </span><span style="color: #b22222;">Send a simple message from the contact form.</span>
    <span style="color: #a020f0;">case</span> <span style="color: #8b2252;">'contact_message'</span>:
      $<span style="color: #a0522d;">message</span>[<span style="color: #8b2252;">'subject'</span>] = <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'E-mail sent from @site-name'</span>, <span style="color: #000000; background-color: #ffffff;">array(</span><span style="color: #8b2252;">'@site-name'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">variable_get(</span><span style="color: #8b2252;">'site_name'</span>, <span style="color: #8b2252;">'Drupal'</span>)), $<span style="color: #a0522d;">options</span>);
      <span style="color: #b22222;">// </span><span style="color: #b22222;">Note that the message body is an array, not a string.</span>
      $<span style="color: #a0522d;">message</span>[<span style="color: #8b2252;">'body'</span>][] = <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'@name sent you the following message:'</span>, <span style="color: #000000; background-color: #ffffff;">array(</span><span style="color: #8b2252;">'@name'</span> =&gt; $<span style="color: #a0522d;">user</span>-&gt;<span style="color: #a0522d;">name</span>), $<span style="color: #a0522d;">options</span>);
      <span style="color: #b22222;">// </span><span style="color: #b22222;">Because this is just user-entered text, we do not need to translate it.</span>

      <span style="color: #b22222;">// </span><span style="color: #b22222;">Since user-entered text may have unintentional HTML entities in it like</span>
      <span style="color: #b22222;">// </span><span style="color: #b22222;">'&lt;' or '&gt;', we need to make sure these entities are properly escaped,</span>
      <span style="color: #b22222;">// </span><span style="color: #b22222;">as the body will later be transformed from HTML to text, meaning</span>
      <span style="color: #b22222;">// </span><span style="color: #b22222;">that a normal use of '&lt;' will result in truncation of the message.</span>
      $<span style="color: #a0522d;">message</span>[<span style="color: #8b2252;">'body'</span>][] = <span style="color: #000000; background-color: #ffffff;">check_plain(</span>$<span style="color: #a0522d;">params</span>[<span style="color: #8b2252;">'message'</span>]);
      <span style="color: #a020f0;">break</span>;
  }
}

<span style="color: #b22222;">/**</span>
<span style="color: #b22222;"> * Send an e-mail.</span>
<span style="color: #b22222;"> *</span>
<span style="color: #b22222;"> * @param $form_values</span>
<span style="color: #b22222;"> *   An array of values from the contact form fields that were submitted.</span>
<span style="color: #b22222;"> *   There are just two relevant items: $form_values['email'] and</span>
<span style="color: #b22222;"> *   $form_values['message'].</span>
<span style="color: #b22222;"> </span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">email_example_mail_send</span>($<span style="color: #a0522d;">form_values</span>) {
  <span style="color: #b22222;">// </span><span style="color: #b22222;">All system mails need to specify the module and template key (mirrored from</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">hook_mail()) that the message they want to send comes from.</span>
  $<span style="color: #a0522d;">module</span> = <span style="color: #8b2252;">'email_example'</span>;
  $<span style="color: #a0522d;">key</span> = <span style="color: #8b2252;">'contact_message'</span>;

  <span style="color: #b22222;">// </span><span style="color: #b22222;">Specify 'to' and 'from' addresses.</span>
  $<span style="color: #a0522d;">to</span> = $<span style="color: #a0522d;">form_values</span>[<span style="color: #8b2252;">'email'</span>];
  $<span style="color: #a0522d;">from</span> = <span style="color: #000000; background-color: #ffffff;">variable_get(</span><span style="color: #8b2252;">'site_mail'</span>, <span style="color: #8b2252;">'admin@example.com'</span>);

  <span style="color: #b22222;">// </span><span style="color: #b22222;">"params" loads in additional context for email content completion in</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">hook_mail(). In this case, we want to pass in the values the user entered</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">into the form, which include the message body in $form_values['message'].</span>
  $<span style="color: #a0522d;">params</span> = $<span style="color: #a0522d;">form_values</span>;

  <span style="color: #b22222;">// </span><span style="color: #b22222;">The language of the e-mail. This will one of three values:</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">* user_preferred_language(): Used for sending mail to a particular website</span>
  <span style="color: #b22222;">//   </span><span style="color: #b22222;">user, so that the mail appears in their preferred language.</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">* global $language: Used when sending a mail back to the user currently</span>
  <span style="color: #b22222;">//   </span><span style="color: #b22222;">viewing the site. This will send it in the language they're currently</span>
  <span style="color: #b22222;">//   </span><span style="color: #b22222;">using.</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">* language_default(): Used when sending mail to a pre-existing, 'neutral'</span>
  <span style="color: #b22222;">//   </span><span style="color: #b22222;">address, such as the system e-mail address, or when you're unsure of the</span>
  <span style="color: #b22222;">//   </span><span style="color: #b22222;">language preferences of the intended recipient.</span>
  <span style="color: #b22222;">//</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">Since in our case, we are sending a message to a random e-mail address that</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">is not necessarily tied to a user account, we will use the site's default</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">language.</span>
  $<span style="color: #a0522d;">language</span> = <span style="color: #000000; background-color: #ffffff;">language_default(</span>);

  <span style="color: #b22222;">// </span><span style="color: #b22222;">Whether or not to automatically send the mail when drupal_mail() is</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">called. This defaults to TRUE, and is normally what you want unless you</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">need to do additional processing before drupal_mail_send() is called.</span>
  $<span style="color: #a0522d;">send</span> = <span style="color: #008b8b;">TRUE</span>;
  <span style="color: #b22222;">// </span><span style="color: #b22222;">Send the mail, and check for success. Note that this does not guarantee</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">message delivery; only that there were no PHP-related issues encountered</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">while sending.</span>
  $<span style="color: #a0522d;">result</span> = <span style="color: #000000; background-color: #ffffff;">drupal_mail(</span>$<span style="color: #a0522d;">module</span>, $<span style="color: #a0522d;">key</span>, $<span style="color: #a0522d;">to</span>, $<span style="color: #a0522d;">language</span>, $<span style="color: #a0522d;">params</span>, $<span style="color: #a0522d;">from</span>, $<span style="color: #a0522d;">send</span>);
  <span style="color: #a020f0;">if</span> ($<span style="color: #a0522d;">result</span>[<span style="color: #8b2252;">'result'</span>] == <span style="color: #008b8b;">TRUE</span>) {
    <span style="color: #000000; background-color: #ffffff;">drupal_set_message(t(</span><span style="color: #8b2252;">'Your message has been sent.'</span>));
  }
  <span style="color: #a020f0;">else</span> {
    <span style="color: #000000; background-color: #ffffff;">drupal_set_message(t(</span><span style="color: #8b2252;">'There was a problem sending your message and it was not sent.'</span>), <span style="color: #8b2252;">'error'</span>);
  }

}

<span style="color: #b22222;">/**</span>
<span style="color: #b22222;"> * Implement hook_mail_alter().</span>
<span style="color: #b22222;"> *</span>
<span style="color: #b22222;"> * This function is not required to send an email using Drupal's mail system.</span>
<span style="color: #b22222;"> *</span>
<span style="color: #b22222;"> * Hook_mail_alter() provides an interface to alter any aspect of email sent by</span>
<span style="color: #b22222;"> * Drupal. You can use this hook to add a common site footer to all outgoing</span>
<span style="color: #b22222;"> * email, add extra header fields, and/or modify the email in anyway. HTML-izing</span>
<span style="color: #b22222;"> * the outgoing email is one possibility.</span>
<span style="color: #b22222;"> </span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">email_example_mail_alter</span>(&amp;$<span style="color: #a0522d;">message</span>) {
  <span style="color: #b22222;">// </span><span style="color: #b22222;">For the purpose of this example, modify all the outgoing messages and</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">attach a site signature. The signature will be translated to the language</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">in which message was built.</span>
  $<span style="color: #a0522d;">options</span> = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'langcode'</span> =<span style="color: #008b8b;">&gt;</span> $<span style="color: #a0522d;">message</span>[<span style="color: #8b2252;">'language'</span>]-&gt;<span style="color: #a0522d;">language</span>,
  );

  $<span style="color: #a0522d;">signature</span> = <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">"\n--\nMail altered by email_example module."</span>, <span style="color: #000000; background-color: #ffffff;">array(</span>), $<span style="color: #a0522d;">options</span>);
  <span style="color: #a020f0;">if</span> (<span style="color: #000000; background-color: #ffffff;">is_array(</span>$<span style="color: #a0522d;">message</span>[<span style="color: #8b2252;">'body'</span>])) {
    $<span style="color: #a0522d;">message</span>[<span style="color: #8b2252;">'body'</span>][] = $<span style="color: #a0522d;">signature</span>;
  }
  <span style="color: #a020f0;">else</span> {  <span style="color: #b22222;">// </span><span style="color: #b22222;">Some modules use the body as a string, erroneously.</span>
    $<span style="color: #a0522d;">message</span>[<span style="color: #8b2252;">'body'</span>] .= $<span style="color: #a0522d;">signature</span>;
  }
}

<span style="color: #b22222;">///// </span><span style="color: #b22222;">Supporting functions ////</span>

<span style="color: #b22222;">/**</span>
<span style="color: #b22222;"> * Implement hook_menu().</span>
<span style="color: #b22222;"> *</span>
<span style="color: #b22222;"> * Set up a page with an e-mail contact form on it.</span>
<span style="color: #b22222;"> </span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">email_example_menu</span>() {
  $<span style="color: #a0522d;">items</span>[<span style="color: #8b2252;">'example/email_example'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'title'</span> =&gt; <span style="color: #8b2252;">'E-mail Example: contact form'</span>,
    <span style="color: #8b2252;">'page callback'</span> =&gt; <span style="color: #8b2252;">'drupal_get_form'</span>,
    <span style="color: #8b2252;">'page arguments'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">array(</span><span style="color: #8b2252;">'email_example_form'</span>),
    <span style="color: #8b2252;">'access arguments'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">array(</span><span style="color: #8b2252;">'access content'</span>),
  );

  <span style="color: #a020f0;">return</span> $<span style="color: #a0522d;">items</span>;
}

<span style="color: #b22222;">/**</span>
<span style="color: #b22222;"> * The contact form.</span>
<span style="color: #b22222;"> </span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">email_example_form</span>() {
  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'intro'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#markup'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'Use this form to send a message to an e-mail address. No spamming!'</span>),
  );
  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'email'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'textfield'</span>,
    <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'E-mail address'</span>),
    <span style="color: #8b2252;">'#required'</span> =&gt; <span style="color: #008b8b;">TRUE</span>,
  );
  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'message'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'textarea'</span>,
    <span style="color: #8b2252;">'#title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'Message'</span>),
    <span style="color: #8b2252;">'#required'</span> =&gt; <span style="color: #008b8b;">TRUE</span>,
  );
  $<span style="color: #a0522d;">form</span>[<span style="color: #8b2252;">'submit'</span>] = <span style="color: #000000; background-color: #ffffff;">array(</span>
    <span style="color: #8b2252;">'#type'</span> =&gt; <span style="color: #8b2252;">'submit'</span>,
    <span style="color: #8b2252;">'#value'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'Submit'</span>),
  );

  <span style="color: #a020f0;">return</span> $<span style="color: #a0522d;">form</span>;
}

<span style="color: #b22222;">/**</span>
<span style="color: #b22222;"> * Form validation logic for the contact form.</span>
<span style="color: #b22222;"> </span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">email_example_form_validate</span>($<span style="color: #a0522d;">form</span>, &amp;$<span style="color: #a0522d;">form_state</span>) {
  <span style="color: #a020f0;">if</span> (!<span style="color: #000000; background-color: #ffffff;">valid_email_address(</span>$<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'values'</span>][<span style="color: #8b2252;">'email'</span>])) {
    <span style="color: #000000; background-color: #ffffff;">form_set_error(</span><span style="color: #8b2252;">'email'</span>, <span style="color: #000000; background-color: #ffffff;">t(</span><span style="color: #8b2252;">'That e-mail address is not valid.'</span>));
  }
}

<span style="color: #b22222;">/**</span>
<span style="color: #b22222;"> * Form submission logic for the contact form.</span>
<span style="color: #b22222;"> </span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">email_example_form_submit</span>($<span style="color: #a0522d;">form</span>, &amp;$<span style="color: #a0522d;">form_state</span>) {
  <span style="color: #000000; background-color: #ffffff;">email_example_mail_send(</span>$<span style="color: #a0522d;">form_state</span>[<span style="color: #8b2252;">'values'</span>]);
}
</pre>
</div>

<p>
Con esto ya podemos activar el módulo desde Administración →
Módulos. Si nos fijamos en la implementación de hook<sub>menu</sub>
(email<sub>example</sub><sub>menu</sub>) vemos que la ruta para visualizar nuestro módulo
es example/email<sub>example</sub> por lo que la introducimos en nuestro
navegador.
</p>

<p>
Otras funciones como email<sub>example</sub><sub>form</sub>, email<sub>example</sub><sub>form</sub><sub>validate</sub> y
email<sub>example</sub><sub>form</sub><sub>submit</sub> también son hooks cuya funcionalidad ya se
ha visto en el apartado Form API y que son, por tanto, para la
construcción del formulario.
</p>

<p>
Las funciones que nos introducen a los nuevos hooks de la api de
correo son: email<sub>example</sub><sub>mail</sub> (hook<sub>mail</sub>), email<sub>example</sub><sub>mail</sub><sub>alter</sub>
(hook<sub>mail</sub><sub>alter</sub>) y una función auxiliar email<sub>example</sub><sub>mail</sub><sub>send</sub> que
llama a drupal<sub>mail</sub>. Ahora se estudiará el comportamiento de cada una.
email<sub>example</sub><sub>mail</sub> define el asunto ($message['subject']) y el cuerpo
($message['body'][]) del mensaje. Mediante el argumento $options a la
función t definimos el idioma. La función check<sub>plain</sub> transforma el
código html a texto plano.  
</p>

<p>
<b>email<sub>example</sub><sub>mail</sub><sub>send</sub></b> establece el valor de todos los argumentos que
va a necesitar drupal<sub>mail</sub> para ejecutarse. Estos valores son en su
mayoría tomados de los valores introducidos por el usuario en el
formulario.
</p>

<p>
<b>email<sub>example</sub><sub>mail</sub><sub>alter</sub></b>. El hook hook<sub>mail</sub><sub>alter</sub> permite modificar
aspectos del mensaje. La implementación del hook ha sido realizada por
motivos didácticos y añade una firma al mensaje. Obviamente esto
podría haberse introducido dentro de email<sub>example</sub><sub>mail</sub>.  
</p>

<p>
Para una mejor comprensión y una información más detallada se
estudiará la documentación de la api de drupal<sub>mail</sub>.
</p>
</div>
</div>
<div id="outline-container-sec-3-14" class="outline-3">
<h3 id="sec-3-14">drupal\<sub>mail</sub></h3>
<div class="outline-text-3" id="text-3-14">
<div class="org-src-container">

<pre class="src src-php"><span style="color: #000000; background-color: #ffffff;">drupal_mail(</span>$<span style="color: #a0522d;">module</span>, $<span style="color: #a0522d;">key</span>, $<span style="color: #a0522d;">to</span>, $<span style="color: #a0522d;">language</span>, $<span style="color: #a0522d;">params</span> = <span style="color: #000000; background-color: #ffffff;">array(</span>), $<span style="color: #a0522d;">from</span> = <span style="color: #008b8b;">NULL</span>, $<span style="color: #a0522d;">send</span> = <span style="color: #008b8b;">TRUE</span>) 

<span style="color: #ff0000; font-weight: bold;">Compone</span> <span style="color: #ff0000; font-weight: bold;">y</span> <span style="color: #ff0000; font-weight: bold;">opcionalmente</span> <span style="color: #ff0000; font-weight: bold;">env&#237;a</span> <span style="color: #ff0000; font-weight: bold;">un</span> <span style="color: #ff0000; font-weight: bold;">mensaje</span>.

<span style="color: #ff0000; font-weight: bold;">El</span> <span style="color: #ff0000; font-weight: bold;">env&#237;o</span> <span style="color: #ff0000; font-weight: bold;">de</span> <span style="color: #ff0000; font-weight: bold;">correo</span> <span style="color: #ff0000; font-weight: bold;">funciona</span> <span style="color: #ff0000; font-weight: bold;">definiendo</span> <span style="color: #ff0000; font-weight: bold;">una</span> <span style="color: #000000; background-color: #ffffff;">plantilla (</span><span style="color: #ff0000; font-weight: bold;">asunto</span>, <span style="color: #ff0000; font-weight: bold;">texto</span> <span style="color: #ff0000; font-weight: bold;">y</span>
<span style="color: #ff0000; font-weight: bold;">posibles</span> <span style="color: #ff0000; font-weight: bold;">cabeceras</span> <span style="color: #ff0000; font-weight: bold;">de</span> <span style="color: #ff0000; font-weight: bold;">e</span>-<span style="color: #ff0000; font-weight: bold;">mail</span>) <span style="color: #ff0000; font-weight: bold;">y</span> <span style="color: #ff0000; font-weight: bold;">los</span> <span style="color: #ff0000; font-weight: bold;">valores</span> <span style="color: #ff0000; font-weight: bold;">de</span> <span style="color: #ff0000; font-weight: bold;">reemplazo</span> <span style="color: #ff0000; font-weight: bold;">para</span> <span style="color: #ff0000; font-weight: bold;">usar</span> <span style="color: #ff0000; font-weight: bold;">en</span>
<span style="color: #ff0000; font-weight: bold;">los</span> <span style="color: #ff0000; font-weight: bold;">lugares</span> <span style="color: #ff0000; font-weight: bold;">apropiados</span> <span style="color: #ff0000; font-weight: bold;">de</span> <span style="color: #ff0000; font-weight: bold;">la</span> <span style="color: #ff0000; font-weight: bold;">plantilla</span>. <span style="color: #ff0000; font-weight: bold;">Dichas</span> <span style="color: #ff0000; font-weight: bold;">plantillas</span> <span style="color: #ff0000; font-weight: bold;">se</span>
<span style="color: #ff0000; font-weight: bold;">construyen</span> <span style="color: #ff0000; font-weight: bold;">desde</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #000000; background-color: #ffffff;">hook_mail(</span>) <span style="color: #ff0000; font-weight: bold;">que</span> <span style="color: #ff0000; font-weight: bold;">hay</span> <span style="color: #ff0000; font-weight: bold;">en</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #ff0000; font-weight: bold;">m&#243;dulo</span> <span style="color: #ff0000; font-weight: bold;">que</span> <span style="color: #ff0000; font-weight: bold;">env&#237;a</span> <span style="color: #ff0000; font-weight: bold;">el</span>
<span style="color: #ff0000; font-weight: bold;">correo</span>. <span style="color: #ff0000; font-weight: bold;">Cualquier</span> <span style="color: #ff0000; font-weight: bold;">m&#243;dulo</span> <span style="color: #ff0000; font-weight: bold;">puede</span> <span style="color: #ff0000; font-weight: bold;">modificar</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #ff0000; font-weight: bold;">mensaje</span> <span style="color: #ff0000; font-weight: bold;">de</span> <span style="color: #ff0000; font-weight: bold;">correo</span> <span style="color: #ff0000; font-weight: bold;">usando</span>
<span style="color: #000000; background-color: #ffffff;">hook_mail_alter(</span>). <span style="color: #ff0000; font-weight: bold;">Finalmente</span>, <span style="color: #000000; background-color: #ffffff;">drupal_mail_system(</span>)-&gt;<span style="color: #000000; background-color: #ffffff;">mail</span>() <span style="color: #ff0000; font-weight: bold;">env&#237;a</span> <span style="color: #ff0000; font-weight: bold;">el</span>
<span style="color: #ff0000; font-weight: bold;">correo</span>, <span style="color: #ff0000; font-weight: bold;">que</span> <span style="color: #ff0000; font-weight: bold;">puede</span> <span style="color: #ff0000; font-weight: bold;">ser</span> <span style="color: #ff0000; font-weight: bold;">reutilizado</span> <span style="color: #ff0000; font-weight: bold;">si</span> <span style="color: #ff0000; font-weight: bold;">ese</span> <span style="color: #ff0000; font-weight: bold;">correo</span> <span style="color: #ff0000; font-weight: bold;">fue</span> <span style="color: #ff0000; font-weight: bold;">compuesto</span> <span style="color: #ff0000; font-weight: bold;">para</span> <span style="color: #ff0000; font-weight: bold;">ser</span>
<span style="color: #ff0000; font-weight: bold;">enviado</span> <span style="color: #ff0000; font-weight: bold;">a</span> <span style="color: #ff0000; font-weight: bold;">m&#250;ltiples</span> <span style="color: #ff0000; font-weight: bold;">destinos</span>.

<span style="color: #ff0000; font-weight: bold;">Encontrar</span> <span style="color: #ff0000; font-weight: bold;">en</span> <span style="color: #ff0000; font-weight: bold;">qu&#233;</span> <span style="color: #ff0000; font-weight: bold;">idioma</span> <span style="color: #ff0000; font-weight: bold;">se</span> <span style="color: #ff0000; font-weight: bold;">enviar&#225;</span> <span style="color: #ff0000; font-weight: bold;">un</span> <span style="color: #ff0000; font-weight: bold;">correo</span> <span style="color: #ff0000; font-weight: bold;">necesita</span> <span style="color: #ff0000; font-weight: bold;">alguna</span>
<span style="color: #ff0000; font-weight: bold;">consideraci&#243;n</span>. <span style="color: #ff0000; font-weight: bold;">Si</span> <span style="color: #ff0000; font-weight: bold;">se</span> <span style="color: #ff0000; font-weight: bold;">env&#237;a</span> <span style="color: #ff0000; font-weight: bold;">correo</span> <span style="color: #ff0000; font-weight: bold;">a</span> <span style="color: #ff0000; font-weight: bold;">un</span> <span style="color: #ff0000; font-weight: bold;">usuario</span>, <span style="color: #ff0000; font-weight: bold;">su</span> <span style="color: #ff0000; font-weight: bold;">idioma</span> <span style="color: #ff0000; font-weight: bold;">preferido</span>
<span style="color: #ff0000; font-weight: bold;">ser&#237;a</span> <span style="color: #ff0000; font-weight: bold;">lo</span> <span style="color: #ff0000; font-weight: bold;">ideal</span>, <span style="color: #ff0000; font-weight: bold;">as&#237;</span> <span style="color: #ff0000; font-weight: bold;">se</span> <span style="color: #ff0000; font-weight: bold;">puede</span> <span style="color: #ff0000; font-weight: bold;">usar</span> <span style="color: #ff0000; font-weight: bold;">la</span> <span style="color: #ff0000; font-weight: bold;">funci&#243;n</span>
<span style="color: #000000; background-color: #ffffff;">user_preferred_language(</span>). <span style="color: #ff0000; font-weight: bold;">Si</span> <span style="color: #ff0000; font-weight: bold;">se</span> <span style="color: #ff0000; font-weight: bold;">env&#237;a</span> <span style="color: #ff0000; font-weight: bold;">correo</span> <span style="color: #ff0000; font-weight: bold;">seg&#250;n</span> <span style="color: #ff0000; font-weight: bold;">los</span> <span style="color: #ff0000; font-weight: bold;">valores</span>
<span style="color: #ff0000; font-weight: bold;">rellenados</span> <span style="color: #ff0000; font-weight: bold;">en</span> <span style="color: #ff0000; font-weight: bold;">un</span> <span style="color: #ff0000; font-weight: bold;">formulario</span> <span style="color: #ff0000; font-weight: bold;">de</span> <span style="color: #ff0000; font-weight: bold;">una</span> <span style="color: #ff0000; font-weight: bold;">determinada</span> <span style="color: #ff0000; font-weight: bold;">p&#225;gina</span>, <span style="color: #ff0000; font-weight: bold;">hay</span> <span style="color: #ff0000; font-weight: bold;">dos</span>
<span style="color: #ff0000; font-weight: bold;">elecciones</span> <span style="color: #ff0000; font-weight: bold;">que</span> <span style="color: #ff0000; font-weight: bold;">hay</span> <span style="color: #ff0000; font-weight: bold;">que</span> <span style="color: #ff0000; font-weight: bold;">hacer</span>, <span style="color: #ff0000; font-weight: bold;">a</span> <span style="color: #ff0000; font-weight: bold;">menos</span> <span style="color: #ff0000; font-weight: bold;">que</span> <span style="color: #ff0000; font-weight: bold;">est&#233;s</span> <span style="color: #ff0000; font-weight: bold;">enviando</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #ff0000; font-weight: bold;">correo</span> <span style="color: #ff0000; font-weight: bold;">a</span>
<span style="color: #ff0000; font-weight: bold;">un</span> <span style="color: #ff0000; font-weight: bold;">usuario</span> <span style="color: #ff0000; font-weight: bold;">del</span> <span style="color: #ff0000; font-weight: bold;">sitio</span>. <span style="color: #ff0000; font-weight: bold;">Se</span> <span style="color: #ff0000; font-weight: bold;">puede</span> <span style="color: #ff0000; font-weight: bold;">usar</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #ff0000; font-weight: bold;">lenguaje</span> <span style="color: #ff0000; font-weight: bold;">usado</span> <span style="color: #ff0000; font-weight: bold;">para</span> <span style="color: #ff0000; font-weight: bold;">generar</span> <span style="color: #ff0000; font-weight: bold;">la</span>
<span style="color: #000000; background-color: #ffffff;">p&#225;gina (</span><span style="color: #ff0000; font-weight: bold;">la</span> <span style="color: #ff0000; font-weight: bold;">variable</span> <span style="color: #a020f0;">global</span> $<span style="color: #a0522d;">language</span>) <span style="color: #ff0000; font-weight: bold;">o</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #ff0000; font-weight: bold;">lenguaje</span> <span style="color: #ff0000; font-weight: bold;">por</span> <span style="color: #ff0000; font-weight: bold;">defecto</span> <span style="color: #ff0000; font-weight: bold;">del</span>
<span style="color: #000000; background-color: #ffffff;">sitio (</span><span style="color: #ff0000; font-weight: bold;">ver</span> <span style="color: #000000; background-color: #ffffff;">language_default(</span>)). <span style="color: #ff0000; font-weight: bold;">El</span> <span style="color: #ff0000; font-weight: bold;">primer</span> <span style="color: #ff0000; font-weight: bold;">m&#233;todo</span> <span style="color: #ff0000; font-weight: bold;">es</span> <span style="color: #ff0000; font-weight: bold;">bueno</span> <span style="color: #ff0000; font-weight: bold;">para</span> <span style="color: #ff0000; font-weight: bold;">enviar</span>
<span style="color: #ff0000; font-weight: bold;">correo</span> <span style="color: #ff0000; font-weight: bold;">a</span> <span style="color: #ff0000; font-weight: bold;">la</span> <span style="color: #ff0000; font-weight: bold;">persona</span> <span style="color: #ff0000; font-weight: bold;">que</span> <span style="color: #ff0000; font-weight: bold;">est&#225;</span> <span style="color: #ff0000; font-weight: bold;">rellenando</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #ff0000; font-weight: bold;">formulario</span> <span style="color: #ff0000; font-weight: bold;">y</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #ff0000; font-weight: bold;">segundo</span> <span style="color: #ff0000; font-weight: bold;">es</span>
<span style="color: #ff0000; font-weight: bold;">bueno</span> <span style="color: #ff0000; font-weight: bold;">si</span> <span style="color: #ff0000; font-weight: bold;">se</span> <span style="color: #ff0000; font-weight: bold;">env&#237;a</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #ff0000; font-weight: bold;">correo</span> <span style="color: #ff0000; font-weight: bold;">a</span> <span style="color: #ff0000; font-weight: bold;">una</span> <span style="color: #ff0000; font-weight: bold;">direcci&#243;n</span> <span style="color: #ff0000; font-weight: bold;">previamente</span> <span style="color: #ff0000; font-weight: bold;">configurada</span>
(<span style="color: #ff0000; font-weight: bold;">como</span> <span style="color: #ff0000; font-weight: bold;">la</span> <span style="color: #ff0000; font-weight: bold;">direcci&#243;n</span> <span style="color: #ff0000; font-weight: bold;">de</span> <span style="color: #ff0000; font-weight: bold;">contacto</span>).

<span style="color: #ff0000; font-weight: bold;">Par&#225;metros</span> 

$<span style="color: #a0522d;">module</span> <span style="color: #ff0000; font-weight: bold;">Un</span> <span style="color: #ff0000; font-weight: bold;">m&#243;dulo</span> <span style="color: #ff0000; font-weight: bold;">invoca</span> <span style="color: #ff0000; font-weight: bold;">a</span> <span style="color: #000000; background-color: #ffffff;">hook_mail(</span>). <span style="color: #ff0000; font-weight: bold;">El</span> <span style="color: #ff0000; font-weight: bold;">hook</span> {$<span style="color: #a0522d;">module</span>}<span style="color: #000000; background-color: #ffffff;">_mail(</span>) <span style="color: #ff0000; font-weight: bold;">ser&#225;</span>
<span style="color: #ff0000; font-weight: bold;">llamado</span> <span style="color: #ff0000; font-weight: bold;">para</span> <span style="color: #ff0000; font-weight: bold;">completar</span> <span style="color: #ff0000; font-weight: bold;">la</span> <span style="color: #ff0000; font-weight: bold;">estructura</span> <span style="color: #ff0000; font-weight: bold;">de</span> $<span style="color: #a0522d;">message</span> <span style="color: #ff0000; font-weight: bold;">que</span> <span style="color: #ff0000; font-weight: bold;">ya</span> <span style="color: #ff0000; font-weight: bold;">contiene</span>
<span style="color: #ff0000; font-weight: bold;">cierto</span> <span style="color: #ff0000; font-weight: bold;">valores</span> <span style="color: #ff0000; font-weight: bold;">por</span> <span style="color: #ff0000; font-weight: bold;">defecto</span>.

$<span style="color: #a0522d;">key</span> <span style="color: #ff0000; font-weight: bold;">Una</span> <span style="color: #ff0000; font-weight: bold;">clave</span> <span style="color: #ff0000; font-weight: bold;">identifica</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #ff0000; font-weight: bold;">correo</span> <span style="color: #ff0000; font-weight: bold;">enviado</span>. <span style="color: #ff0000; font-weight: bold;">El</span> <span style="color: #ff0000; font-weight: bold;">id</span> <span style="color: #ff0000; font-weight: bold;">del</span> <span style="color: #ff0000; font-weight: bold;">correo</span> <span style="color: #ff0000; font-weight: bold;">para</span>
<span style="color: #ff0000; font-weight: bold;">alterarlo</span> <span style="color: #ff0000; font-weight: bold;">ser&#225;</span> {$<span style="color: #a0522d;">module</span>}<span style="color: #ff0000; font-weight: bold;">_</span>{$<span style="color: #a0522d;">key</span>}.

$<span style="color: #a0522d;">to</span> <span style="color: #ff0000; font-weight: bold;">La</span> <span style="color: #ff0000; font-weight: bold;">direcci&#243;n</span> <span style="color: #ff0000; font-weight: bold;">&#243;</span> <span style="color: #ff0000; font-weight: bold;">direcciones</span> <span style="color: #ff0000; font-weight: bold;">de</span> <span style="color: #ff0000; font-weight: bold;">correo</span> <span style="color: #ff0000; font-weight: bold;">a</span> <span style="color: #ff0000; font-weight: bold;">las</span> <span style="color: #ff0000; font-weight: bold;">que</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #ff0000; font-weight: bold;">mensaje</span> <span style="color: #ff0000; font-weight: bold;">se</span>
<span style="color: #ff0000; font-weight: bold;">enviar&#225;</span>. <span style="color: #ff0000; font-weight: bold;">El</span> <span style="color: #ff0000; font-weight: bold;">formato</span> <span style="color: #ff0000; font-weight: bold;">de</span> <span style="color: #ff0000; font-weight: bold;">esta</span> <span style="color: #ff0000; font-weight: bold;">cadena</span> <span style="color: #ff0000; font-weight: bold;">cumplir&#225;</span> <span style="color: #ff0000; font-weight: bold;">con</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #ff0000; font-weight: bold;">RFC</span> <span style="color: #000000; background-color: #ffffff;">2822</span>. <span style="color: #ff0000; font-weight: bold;">Algunos</span>
<span style="color: #ff0000; font-weight: bold;">ejemplos</span> <span style="color: #ff0000; font-weight: bold;">son</span>:

<span style="color: #ff0000; font-weight: bold;">user</span>@<span style="color: #ff0000; font-weight: bold;">example</span>.<span style="color: #ff0000; font-weight: bold;">com</span> 
<span style="color: #ff0000; font-weight: bold;">user</span>@<span style="color: #ff0000; font-weight: bold;">example</span>.<span style="color: #ff0000; font-weight: bold;">com</span>, <span style="color: #ff0000; font-weight: bold;">anotheruser</span>@<span style="color: #ff0000; font-weight: bold;">example</span>.<span style="color: #ff0000; font-weight: bold;">com</span> 
<span style="color: #ff0000; font-weight: bold;">User</span> <span style="color: #008b8b;">&lt;user</span>@<span style="color: #ff0000; font-weight: bold;">example</span>.<span style="color: #ff0000; font-weight: bold;">com</span><span style="color: #008b8b;">&gt;</span> 
<span style="color: #ff0000; font-weight: bold;">User</span> <span style="color: #008b8b;">&lt;user</span>@<span style="color: #ff0000; font-weight: bold;">example</span>.<span style="color: #ff0000; font-weight: bold;">com</span><span style="color: #008b8b;">&gt;</span>, <span style="color: #ff0000; font-weight: bold;">Another</span> <span style="color: #ff0000; font-weight: bold;">User</span> <span style="color: #008b8b;">&lt;anotheruser</span>@<span style="color: #ff0000; font-weight: bold;">example</span>.<span style="color: #ff0000; font-weight: bold;">com</span><span style="color: #008b8b;">&gt;</span> 
$<span style="color: #a0522d;">language</span> <span style="color: #ff0000; font-weight: bold;">El</span> <span style="color: #ff0000; font-weight: bold;">idioma</span> <span style="color: #ff0000; font-weight: bold;">usado</span> <span style="color: #ff0000; font-weight: bold;">para</span> <span style="color: #ff0000; font-weight: bold;">componer</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #ff0000; font-weight: bold;">correo</span>.
$<span style="color: #a0522d;">params</span> <span style="color: #ff0000; font-weight: bold;">Par&#225;metro</span> <span style="color: #ff0000; font-weight: bold;">opcionales</span> <span style="color: #ff0000; font-weight: bold;">para</span> <span style="color: #ff0000; font-weight: bold;">construir</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #ff0000; font-weight: bold;">correo</span>.
$<span style="color: #a0522d;">from</span> <span style="color: #ff0000; font-weight: bold;">Establece</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #ff0000; font-weight: bold;">From</span> <span style="color: #ff0000; font-weight: bold;">si</span> <span style="color: #ff0000; font-weight: bold;">este</span> <span style="color: #ff0000; font-weight: bold;">es</span> <span style="color: #ff0000; font-weight: bold;">dado</span>.
$<span style="color: #a0522d;">send</span> <span style="color: #ff0000; font-weight: bold;">Env&#237;a</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #ff0000; font-weight: bold;">mensaje</span> <span style="color: #ff0000; font-weight: bold;">directamente</span>, <span style="color: #ff0000; font-weight: bold;">sin</span> <span style="color: #ff0000; font-weight: bold;">llamar</span> <span style="color: #ff0000; font-weight: bold;">a</span>
<span style="color: #000000; background-color: #ffffff;">drupal_mail_system(</span>)-&gt;<span style="color: #000000; background-color: #ffffff;">mail</span>() <span style="color: #ff0000; font-weight: bold;">manualmente</span>.

<span style="color: #ff0000; font-weight: bold;">Valor</span> <span style="color: #ff0000; font-weight: bold;">devuelto</span>

<span style="color: #ff0000; font-weight: bold;">La</span> <span style="color: #ff0000; font-weight: bold;">estructura</span> <span style="color: #ff0000; font-weight: bold;">del</span> <span style="color: #ff0000; font-weight: bold;">array</span> $<span style="color: #a0522d;">message</span> <span style="color: #ff0000; font-weight: bold;">conteniendo</span> <span style="color: #ff0000; font-weight: bold;">todos</span> <span style="color: #ff0000; font-weight: bold;">los</span> <span style="color: #ff0000; font-weight: bold;">detalles</span> <span style="color: #ff0000; font-weight: bold;">del</span>
<span style="color: #ff0000; font-weight: bold;">mensaje</span>. <span style="color: #ff0000; font-weight: bold;">Si</span> <span style="color: #ff0000; font-weight: bold;">ya</span> <span style="color: #ff0000; font-weight: bold;">se</span> <span style="color: #000000; background-color: #ffffff;">envi&#243; (</span>$<span style="color: #a0522d;">send</span> = <span style="color: #008b8b;">TRUE</span>), <span style="color: #ff0000; font-weight: bold;">entonces</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #ff0000; font-weight: bold;">elmento</span> <span style="color: #8b2252;">'result'</span>
<span style="color: #ff0000; font-weight: bold;">contendr&#225;</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #ff0000; font-weight: bold;">indicador</span> <span style="color: #ff0000; font-weight: bold;">de</span> <span style="color: #ff0000; font-weight: bold;">&#233;xitos</span> <span style="color: #ff0000; font-weight: bold;">del</span> <span style="color: #ff0000; font-weight: bold;">correo</span>, <span style="color: #ff0000; font-weight: bold;">si</span> <span style="color: #ff0000; font-weight: bold;">ha</span> <span style="color: #ff0000; font-weight: bold;">habido</span> <span style="color: #ff0000; font-weight: bold;">fallo</span> <span style="color: #ff0000; font-weight: bold;">se</span>
<span style="color: #ff0000; font-weight: bold;">escribir&#225;</span> <span style="color: #ff0000; font-weight: bold;">en</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #ff0000; font-weight: bold;">watchdog</span>. (<span style="color: #ff0000; font-weight: bold;">&#201;xito</span> <span style="color: #ff0000; font-weight: bold;">solo</span> <span style="color: #ff0000; font-weight: bold;">significa</span> <span style="color: #ff0000; font-weight: bold;">que</span> <span style="color: #ff0000; font-weight: bold;">el</span> <span style="color: #ff0000; font-weight: bold;">mensaje</span> <span style="color: #ff0000; font-weight: bold;">ha</span> <span style="color: #ff0000; font-weight: bold;">sido</span>
<span style="color: #ff0000; font-weight: bold;">aceptado</span> <span style="color: #ff0000; font-weight: bold;">a</span> <span style="color: #ff0000; font-weight: bold;">nivel</span> <span style="color: #ff0000; font-weight: bold;">php</span>, <span style="color: #ff0000; font-weight: bold;">lo</span> <span style="color: #ff0000; font-weight: bold;">que</span> <span style="color: #ff0000; font-weight: bold;">no</span> <span style="color: #ff0000; font-weight: bold;">garantiza</span> <span style="color: #ff0000; font-weight: bold;">que</span> <span style="color: #ff0000; font-weight: bold;">sea</span> <span style="color: #ff0000; font-weight: bold;">entregado</span>.)
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-3-15" class="outline-3">
<h3 id="sec-3-15">Creando Tipos de Contenido</h3>
<div class="outline-text-3" id="text-3-15">
<p>
Drupal 7 introduce grandes cambios en el modo en que Drupal gestiona
el contenido. En anteriores versiones, todo el contenido era
considerado un "nodo". Creando contenido mediante un objeto estándar
con una API común, cualquier módulo podría añadir datos para manipular
este objeto para crear modelos de datos y workflows complejos.
</p>

<p>
Esto funcionaba extremadamente bien, con la excepción de que Drupal
tenía varios otros tipos de objetos, tales como usuarios ó
comentarios, que no eran realmente "contenido" per se pero todavía
podrían beneficiarse de la misma API. Para Drupal 7, la mayoría de
estos tipos de objetos separados fueron fusionados dentro de un simple
super sistema conocido como "entidades". Nodos, usuarios, comentarios
y varios otros tipos de datos son ahora instancias del objeto de datos
genérico Entidad. Esto permite que todos los tipos de datos tengan la
misma, ó al menos muy similar, API y workflow, evitando código
duplicado y reduciendo el número de partes en movimiento a las que los
desarrolladores necesitan seguir la pista. Más importante, ello
permite adjuntar Fields, esto es, añadir discretas piezas de
información a cualquier tipo de entidad y no solo a nodos.
</p>

<p>
En esta sección, se verá cómo definir tipos de entidades. Hay un
montón de partes en movimiento y mientras el sistema de entidades
automatiza mucho del proceso para nosotros, no automatiza todas las
cosas.
</p>
</div>
</div>
<div id="outline-container-sec-3-16" class="outline-3">
<h3 id="sec-3-16">Por qué crear tus propias entidades</h3>
<div class="outline-text-3" id="text-3-16">
<p>
En general, no es necesario crear un nuevo tipo de entidad. Los nodos
son extremadamente flexibles. Sin embargo, hay casos donde es
necesario crear entidades separadas, en vez de tipos de nodos, como
por ejemplo:
</p>

<ul class="org-ul">
<li>Es posible necesitar entidades que tienen un manejo de permisos ó
workflow totalmente diferente a los nodos, tales como productos en
un sistema de comercio electrónico.
</li>

<li>Es posible acceder a entidades que no se almacenan en la base de
datos Drupal.
</li>

<li>Es posible necesitar tener variantes internas, como tipos de nodos,
pero los nodos no soportan "tipos subtipo"
</li>
</ul>

<p>
Por simplicidad no se hará nada demasiado exótico por ahora. Si no que
nos fijaremos en un relativamente simple caso de uso y lo compararemos
con el manejo de nodos.
</p>
</div>
</div>
<div id="outline-container-sec-3-17" class="outline-3">
<h3 id="sec-3-17">El Objetivo</h3>
<div class="outline-text-3" id="text-3-17">
<p>
En el ejemplo, se creará una nueva entidad llamada "artwork". Esta
entidad representará un trabajo de arte de un museo y gestionado a
través de Drupal. Como los nodos, los trabajos de arte tendrán
subtipos como pintura ("painting") y escultura ("sculpture"). Se
querrá permitir a los usuarios crear, editar y eliminar artworks, así
como configurar qué campos están disponibles en cada tipo de artwork.
</p>

<p>
En la práctica la mayoría de museos reales tendría su colección
almacenada en un sistema dedicado de gestión de colecciones y solo se
necesitaría proporcionar un wrapper que lea los datos de él en un modo
Drupal. Para nuestros propósitos aunque se asumirá que es un muy
pequeño museo que quiere usar Drupal por sí mismo como un simple
sistema de gestión de colecciones, que implica capacidades de
creación, lectura, actualización y borrado.
</p>
</div>
</div>
<div id="outline-container-sec-3-18" class="outline-3">
<h3 id="sec-3-18">Bundles</h3>
<div class="outline-text-3" id="text-3-18">
<p>
En anteriores versiones de Drupal solo los nodos tenían la capacidad
de tener subtipos. En Drupal 7, todas las entidades tienen la
capacidad de soportar sutipos. En jerga Drupal, estos subtipos son
llamados "bundles".
</p>

<p>
Un bundle es un subtipo de una entidad que puede ser configurado
separadamente.
</p>
</div>
</div>
<div id="outline-container-sec-3-19" class="outline-3">
<h3 id="sec-3-19">El Esquema de la API</h3>
<div class="outline-text-3" id="text-3-19">
<p>
Es necesario un lugar para almacenar los datos de artwork, así es que
se necesitará crear nuevas tablas en la base de datos. En vez de
crearlas directamente, dejaremos que Drupal lo haga usando una parte
de la capa de la base de datos llamada el Esquema de la API (Schema
API).
</p>

<p>
Lo primero es crear un módulo llamado "artwork". Hay que empezar con
los ficheros artwork.info y artwork.module como ya se ha visto
anteriormente. Sin embargo, también se añadirá otro fichero,
artwork.install. Este fichero contiene hooks que Drupal
</p>
</div>
</div>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">Licencia</h2>
<div class="outline-text-2" id="text-4">
<p>
Copyright (C)  2013 David Arroyo Menéndez
    Se permite copiar, distribuir y/o modificar este documento
    bajo los términos de la GNU Free Documentation License, Version 1.3
    o cualquier versión publicada por la Free Software Foundation;
    sin Secciones Invariantes y sin Textos de Portada o Contraportada.
    Una copia de la licencia está incluida en <a href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License</a>.
</p>


<div class="figure">
<p><a href="https://www.gnu.org/copyleft/fdl.html"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/42/GFDL_Logo.svg/200px-GFDL_Logo.svg.png" alt="200px-GFDL_Logo.svg.png" /></a>
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Autor: David Arroyo Menéndez</p>
<p class="date">Created: 2013-12-20 vie 12:48</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.2.1 (<a href="http://orgmode.org">Org</a> mode 8.2.3c)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
